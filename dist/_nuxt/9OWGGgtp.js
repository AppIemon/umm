import{e as V,f as F,g as L,r as u,h as B,i as O,j as x,c as n,o,a as t,n as m,k as c,F as E,l as U,m as M,t as i,d as Y,p as S,v as $,q as G}from"./Cgo8w6rr.js";import{_ as H}from"./DlAUqK2U.js";const q={class:"maps-page"},z={class:"container"},J={class:"page-header"},K={class:"tabs"},j={key:0,class:"map-grid"},Q={class:"card-header"},W={key:0,class:"verified-tag"},X={key:1,class:"rating-tag"},Z={key:2,class:"rating-tag empty"},tt={class:"date"},et={class:"map-title"},st={key:0,class:"verified-icon",title:"Verified Map"},at={class:"map-info"},nt={class:"creator"},ot={class:"duration"},it={key:0,class:"my-progress"},lt={class:"actions"},rt=["onClick"],ct=["onClick"],dt=["onClick"],ut=["onClick"],vt=["onClick"],_t=["onClick"],ft={key:0,class:"rename-modal"},ht={class:"modal-content glass-panel"},pt={class:"modal-actions"},yt={key:1,class:"rename-modal"},mt={class:"modal-content glass-panel"},gt={class:"rating-info"},kt={class:"rating-slider-container"},Ct={class:"modal-actions"},bt={key:2,class:"empty-state"},At={key:1,class:"loading-state"},Et=V({__name:"maps",setup(Mt){const{user:g}=F(),p=L(),l=u("my"),h=u([]),y=u(!0),d=u(null),_=u(""),r=u(null),v=u(15),k=async()=>{y.value=!0;try{const s=l.value==="my"?g.value?.username||"Guest":void 0,e=l.value==="shared"?"true":void 0;h.value=await $fetch("/api/maps",{query:{creator:s,shared:e}})}catch(s){console.error("Fetch maps error:",s)}finally{y.value=!1}},C=B(()=>h.value),T=async s=>{try{const e=await $fetch(`/api/maps/${s._id}`);sessionStorage.setItem("umm_load_map",JSON.stringify(e)),p.push("/play")}catch{alert("Failed to load map data.")}},R=async s=>{try{const e=await $fetch(`/api/maps/${s._id}`);sessionStorage.setItem("umm_edit_map",JSON.stringify(e)),p.push("/editor")}catch{alert("Failed to load map data.")}},N=async s=>{if(confirm(`Are you sure you want to delete "${s.title}"?`))try{await $fetch(`/api/maps/${s._id}`,{method:"DELETE"}),h.value=h.value.filter(e=>e._id!==s._id)}catch{alert("Map deletion failed.")}},D=s=>{d.value=s,_.value=s.title},b=async()=>{if(!(!d.value||!_.value.trim()))try{const s=await $fetch(`/api/maps/${d.value._id}`,{method:"PATCH",body:{title:_.value.trim()}});d.value.title=s.title,d.value=null}catch{alert("Rename failed.")}},w=async s=>{try{const e=await $fetch(`/api/maps/${s._id}`,{method:"PATCH",body:{isShared:!s.isShared}});s.isShared=e.isShared}catch{alert("Toggle share failed.")}},A=s=>s<8?"#00ff88":s<16?"#ffff00":s<24?"#ff8800":"#ff4444",I=s=>{r.value=s,v.value=Math.round(s.rating)||15},P=async()=>{if(r.value)try{const s=await $fetch(`/api/maps/${r.value._id}/rate`,{method:"POST",body:{rating:v.value}});r.value.rating=s.rating,r.value.ratingCount=s.ratingCount,r.value=null}catch{alert("Rating failed.")}};return O(l,k),x(()=>{if(!g.value){alert("Guest cannot access MAP Database. Please Login."),p.push("/");return}k()}),(s,e)=>(o(),n("div",q,[e[9]||(e[9]=t("div",{class:"background-anim"},null,-1)),t("div",z,[t("header",J,[e[6]||(e[6]=t("h1",{class:"title"},"MAP_DATABASE",-1)),t("div",K,[t("button",{class:m(["tab-btn",{active:l.value==="my"}]),onClick:e[0]||(e[0]=a=>l.value="my")}," MY_ENTRIES ",2),t("button",{class:m(["tab-btn",{active:l.value==="shared"}]),onClick:e[1]||(e[1]=a=>l.value="shared")}," GLOBAL_UPLOADS ",2)])]),y.value?(o(),n("div",At," ACCESSING DATABASE... ")):(o(),n("div",j,[(o(!0),n(E,null,U(C.value,a=>(o(),n("div",{key:a._id,class:m(["map-card",{"is-verified":a.isVerified}])},[t("div",Q,[t("span",{class:"diff-tag",style:M({color:A(a.difficulty)})}," DIFF: "+i(a.difficulty),5),a.isVerified?(o(),n("span",W,"✓ VERIFIED")):c("",!0),a.rating>0?(o(),n("span",X," RATE: ★"+i(a.rating.toFixed(1)),1)):(o(),n("span",Z," RATE: - ")),t("span",tt,i(new Date(a.createdAt).toLocaleDateString()),1)]),t("h3",et,[Y(i(a.title)+" ",1),a.isVerified?(o(),n("span",st,"✓")):c("",!0)]),t("div",at,[t("span",nt,"BY: "+i(a.creatorName),1),t("span",ot,i(Math.floor(a.duration))+"s",1),a.myBestProgress!==void 0?(o(),n("span",it,"MY: "+i(Math.floor(a.myBestProgress))+"%",1)):c("",!0)]),t("div",lt,[t("button",{onClick:f=>T(a),class:"action-btn play"},"PLAY",8,rt),l.value==="my"?(o(),n(E,{key:0},[t("button",{onClick:f=>R(a),class:"action-btn edit"},"EDIT",8,ct),t("button",{onClick:f=>D(a),class:"action-btn rename"},"RENAME",8,dt),t("button",{onClick:f=>w(a),class:"action-btn share"},i(a.isShared?"PRIVATE":"SHARE"),9,ut),t("button",{onClick:f=>N(a),class:"action-btn delete"},"DEL",8,vt)],64)):c("",!0),l.value==="shared"&&a.isVerified?(o(),n("button",{key:1,onClick:f=>I(a),class:"action-btn rate"},"RATE",8,_t)):c("",!0)])],2))),128)),d.value?(o(),n("div",ft,[t("div",ht,[e[7]||(e[7]=t("h3",null,"RENAME_ENTRY",-1)),S(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),placeholder:"Enter new title...",onKeyup:G(b,["enter"])},null,544),[[$,_.value]]),t("div",pt,[t("button",{onClick:b,class:"confirm"},"CONFIRM"),t("button",{onClick:e[3]||(e[3]=a=>d.value=null),class:"cancel"},"CANCEL")])])])):c("",!0),r.value?(o(),n("div",yt,[t("div",mt,[e[8]||(e[8]=t("h3",null,"RATE_MAP",-1)),t("p",gt,i(r.value.title),1),t("div",kt,[S(t("input",{type:"range",min:"1",max:"30","onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),class:"rating-slider"},null,512),[[$,v.value,void 0,{number:!0}]]),t("span",{class:"rating-value",style:M({color:A(v.value)})},i(v.value),5)]),t("div",Ct,[t("button",{onClick:P,class:"confirm"},"SUBMIT"),t("button",{onClick:e[5]||(e[5]=a=>r.value=null),class:"cancel"},"CANCEL")])])])):c("",!0),C.value.length===0?(o(),n("div",bt," NO DATA FOUND IN THIS SECTOR ")):c("",!0)]))])]))}}),Tt=H(Et,[["__scopeId","data-v-f167607d"]]);export{Tt as default};
