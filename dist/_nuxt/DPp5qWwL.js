import{e as V,f as L,g as B,r as u,h as F,i as O,j as x,c as n,o,a as t,n as m,k as c,F as E,l as U,m as M,t as i,d as Y,p as T,v as S,q as G}from"./DcswZMe2.js";import{_ as H}from"./DlAUqK2U.js";const q={class:"maps-page"},z={class:"container"},K={class:"page-header"},j={class:"tabs"},J={key:0,class:"map-grid"},Q={class:"card-header"},W={key:0,class:"verified-tag"},X={key:1,class:"rating-tag"},Z={key:2,class:"rating-tag empty"},tt={class:"date"},et={class:"map-title"},st={key:0,class:"verified-icon",title:"Verified Map"},at={class:"map-info"},nt={class:"creator"},ot={class:"duration"},it={key:0,class:"my-progress"},lt={class:"actions"},rt=["onClick"],ct=["onClick"],dt=["onClick"],ut=["onClick"],vt=["onClick"],_t=["onClick"],ft={key:0,class:"rename-modal"},ht={class:"modal-content glass-panel"},pt={class:"modal-actions"},yt={key:1,class:"rename-modal"},mt={class:"modal-content glass-panel"},gt={class:"rating-info"},kt={class:"rating-slider-container"},Ct={class:"modal-actions"},bt={key:2,class:"empty-state"},At={key:1,class:"loading-state"},Et=V({__name:"maps",setup(Mt){const{user:g}=L(),p=B(),l=u("my"),h=u([]),y=u(!0),d=u(null),_=u(""),r=u(null),v=u(15),k=async()=>{y.value=!0;try{const e=l.value==="my"?g.value?.username||"Guest":void 0,s=l.value==="shared"?"true":void 0;h.value=await $fetch("/api/maps",{query:{creator:e,shared:s}})}catch(e){console.error("Fetch maps error:",e)}finally{y.value=!1}},C=F(()=>h.value),$=e=>{p.push({path:"/play",query:{map:e._id}})},R=async e=>{try{const s=await $fetch(`/api/maps/${e._id}`);sessionStorage.setItem("umm_edit_map",JSON.stringify(s)),p.push("/editor")}catch{alert("Failed to load map data.")}},D=async e=>{if(confirm(`Are you sure you want to delete "${e.title}"?`))try{await $fetch(`/api/maps/${e._id}`,{method:"DELETE"}),h.value=h.value.filter(s=>s._id!==e._id)}catch{alert("Map deletion failed.")}},N=e=>{d.value=e,_.value=e.title},b=async()=>{if(!(!d.value||!_.value.trim()))try{const e=await $fetch(`/api/maps/${d.value._id}`,{method:"PATCH",body:{title:_.value.trim()}});d.value.title=e.title,d.value=null}catch{alert("Rename failed.")}},w=async e=>{try{const s=await $fetch(`/api/maps/${e._id}`,{method:"PATCH",body:{isShared:!e.isShared}});e.isShared=s.isShared}catch{alert("Toggle share failed.")}},A=e=>e<8?"#00ff88":e<16?"#ffff00":e<24?"#ff8800":"#ff4444",I=e=>{r.value=e,v.value=Math.round(e.rating)||15},P=async()=>{if(r.value)try{const e=await $fetch(`/api/maps/${r.value._id}/rate`,{method:"POST",body:{rating:v.value}});r.value.rating=e.rating,r.value.ratingCount=e.ratingCount,r.value=null}catch{alert("Rating failed.")}};return O(l,k),x(()=>{if(!g.value){alert("Guest cannot access MAP Database. Please Login."),p.push("/");return}k()}),(e,s)=>(o(),n("div",q,[s[9]||(s[9]=t("div",{class:"background-anim"},null,-1)),t("div",z,[t("header",K,[s[6]||(s[6]=t("h1",{class:"title"},"MAP_DATABASE",-1)),t("div",j,[t("button",{class:m(["tab-btn",{active:l.value==="my"}]),onClick:s[0]||(s[0]=a=>l.value="my")}," MY_ENTRIES ",2),t("button",{class:m(["tab-btn",{active:l.value==="shared"}]),onClick:s[1]||(s[1]=a=>l.value="shared")}," GLOBAL_UPLOADS ",2)])]),y.value?(o(),n("div",At," ACCESSING DATABASE... ")):(o(),n("div",J,[(o(!0),n(E,null,U(C.value,a=>(o(),n("div",{key:a._id,class:m(["map-card",{"is-verified":a.isVerified}])},[t("div",Q,[t("span",{class:"diff-tag",style:M({color:A(a.difficulty)})}," DIFF: "+i(a.difficulty),5),a.isVerified?(o(),n("span",W,"✓ VERIFIED")):c("",!0),a.rating>0?(o(),n("span",X," RATE: ★"+i(a.rating.toFixed(1)),1)):(o(),n("span",Z," RATE: - ")),t("span",tt,i(new Date(a.createdAt).toLocaleDateString()),1)]),t("h3",et,[Y(i(a.title)+" ",1),a.isVerified?(o(),n("span",st,"✓")):c("",!0)]),t("div",at,[t("span",nt,"BY: "+i(a.creatorName),1),t("span",ot,i(Math.floor(a.duration))+"s",1),a.myBestProgress!==void 0?(o(),n("span",it,"MY: "+i(Math.floor(a.myBestProgress))+"%",1)):c("",!0)]),t("div",lt,[t("button",{onClick:f=>$(a),class:"action-btn play"},"PLAY",8,rt),l.value==="my"?(o(),n(E,{key:0},[t("button",{onClick:f=>R(a),class:"action-btn edit"},"EDIT",8,ct),t("button",{onClick:f=>N(a),class:"action-btn rename"},"RENAME",8,dt),t("button",{onClick:f=>w(a),class:"action-btn share"},i(a.isShared?"PRIVATE":"SHARE"),9,ut),t("button",{onClick:f=>D(a),class:"action-btn delete"},"DEL",8,vt)],64)):c("",!0),l.value==="shared"&&a.isVerified?(o(),n("button",{key:1,onClick:f=>I(a),class:"action-btn rate"},"RATE",8,_t)):c("",!0)])],2))),128)),d.value?(o(),n("div",ft,[t("div",ht,[s[7]||(s[7]=t("h3",null,"RENAME_ENTRY",-1)),T(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>_.value=a),placeholder:"Enter new title...",onKeyup:G(b,["enter"])},null,544),[[S,_.value]]),t("div",pt,[t("button",{onClick:b,class:"confirm"},"CONFIRM"),t("button",{onClick:s[3]||(s[3]=a=>d.value=null),class:"cancel"},"CANCEL")])])])):c("",!0),r.value?(o(),n("div",yt,[t("div",mt,[s[8]||(s[8]=t("h3",null,"RATE_MAP",-1)),t("p",gt,i(r.value.title),1),t("div",kt,[T(t("input",{type:"range",min:"1",max:"30","onUpdate:modelValue":s[4]||(s[4]=a=>v.value=a),class:"rating-slider"},null,512),[[S,v.value,void 0,{number:!0}]]),t("span",{class:"rating-value",style:M({color:A(v.value)})},i(v.value),5)]),t("div",Ct,[t("button",{onClick:P,class:"confirm"},"SUBMIT"),t("button",{onClick:s[5]||(s[5]=a=>r.value=null),class:"cancel"},"CANCEL")])])])):c("",!0),C.value.length===0?(o(),n("div",bt," NO DATA FOUND IN THIS SECTOR ")):c("",!0)]))])]))}}),$t=H(Et,[["__scopeId","data-v-f2959a4b"]]);export{$t as default};
