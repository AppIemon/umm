import{e as Me,r as x,h as me,j as ke,i as he,c as E,o as I,a as t,k as J,n as de,F as _e,l as Ae,t as j,s as we,d as K,x as Oe,f as Ge,y as Le,b as qe,m as be,p as ze,v as je,z as Ve,g as Ye,A as We}from"./DcswZMe2.js";import{_ as xe}from"./DlAUqK2U.js";import{_ as He}from"./gnT7fiFC.js";import{G as Se}from"./B98MRPuF.js";import{t as Xe,M as Je,s as Ke,C as Ze}from"./CUbsk6PR.js";import{s as Qe}from"./D-aQuylm.js";const et="ImpossibleTimingDB",ae="recent_songs",tt=2,Re=20,at=()=>{const Y=()=>new Promise((D,h)=>{const u=indexedDB.open(et,tt);u.onerror=()=>h("IndexedDB error"),u.onupgradeneeded=a=>{const p=a.target.result;if(!p.objectStoreNames.contains(ae)){const A=p.createObjectStore(ae,{keyPath:"id"});A.createIndex("name","name",{unique:!1}),A.createIndex("addedAt","addedAt",{unique:!1})}p.objectStoreNames.contains("songs")||p.createObjectStore("songs",{keyPath:"id"})},u.onsuccess=a=>{D(a.target.result)}});return{addSong:async D=>{const h=await Y();return new Promise(async(u,a)=>{try{const A=h.transaction([ae],"readwrite").objectStore(ae),b=A.index("name").getAll(D.name);b.onsuccess=async()=>{const P=b.result;for(const r of P)A.delete(r.id);const y={id:crypto.randomUUID(),name:D.name,blob:D,addedAt:Date.now()};A.add(y);const v=A.index("addedAt").getAll();v.onsuccess=()=>{const r=v.result;if(r.length>Re){const i=r.sort((L,N)=>L.addedAt-N.addedAt).slice(0,r.length-Re);for(const L of i)A.delete(L.id)}},u(y)},b.onerror=()=>a("Error checking duplicates")}catch(p){a(p)}})},getSongs:async()=>{const D=await Y();return new Promise((h,u)=>{const A=D.transaction([ae],"readonly").objectStore(ae).getAll();A.onsuccess=()=>{const w=A.result.sort((b,P)=>P.addedAt-b.addedAt);h(w)},A.onerror=()=>u("Error fetching songs")})},deleteSong:async D=>{const h=await Y();return new Promise((u,a)=>{const w=h.transaction([ae],"readwrite").objectStore(ae).delete(D);w.onsuccess=()=>u(),w.onerror=()=>a("Error deleting song")})},clearAll:async()=>{const D=await Y();return new Promise((h,u)=>{const A=D.transaction([ae],"readwrite").objectStore(ae).clear();A.onsuccess=()=>h(),A.onerror=()=>u("Error clearing songs")})}}},st={class:"song-selector"},ot={class:"tabs"},nt={key:0,class:"tab-content"},lt={class:"sample-list"},it=["onClick"],rt={class:"sample-info"},ut={class:"sample-name"},ct={class:"sample-meta"},dt={key:0,class:"loading-indicator"},ft={key:1,class:"tab-content"},vt={key:0},pt={key:1,class:"highlight"},mt={key:2,class:"tab-content"},gt={class:"youtube-guide"},ht={class:"guide-steps"},yt={class:"step"},wt={class:"step-content"},bt={key:3,class:"tab-content"},St={key:0,class:"storage-list"},_t=["onClick"],At={class:"song-info"},Mt={class:"name"},kt={class:"date"},xt=["onClick"],Dt={key:1,class:"empty-state"},Tt=["disabled"],It=Me({__name:"SongSelector",emits:["select"],setup(Y,{emit:B}){const m=B,f=x("samples"),S=x(null),D=x(null),h=x(null),{addSong:u,getSongs:a,deleteSong:p,clearAll:A}=at(),w=x([]),b=x(null),P=x([{id:"1",name:"God Chang-seop (ì‹ ì°½ì„­) 'ë°”ë¡œ ë¦¬ë¶€íŠ¸ ì •ìƒí™”' MV",genre:"K-Pop",duration:"3:36",url:"/audio/samples/God Chang-seop (ì‹ ì°½ì„­) 'ë°”ë¡œ ë¦¬ë¶€íŠ¸ ì •ìƒí™”' MV.mp3"},{id:"2",name:"I Love You",genre:"Pop",duration:"3:41",url:"/audio/samples/I Love You.mp3"},{id:"3",name:"Nyan Cat! [Official]",genre:"Electronic",duration:"3:37",url:"/audio/samples/Nyan Cat! [Official].mp3"}]),y=x(null),v=x(null),r=me(()=>f.value==="youtube"||v.value?!1:h.value||b.value||y.value);async function g(){try{w.value=await a()}catch(_){console.error("Failed to load recent songs:",_)}}function i(_){const n=new Date(_),q=new Date().getTime()-n.getTime(),re=Math.floor(q/6e4),H=Math.floor(q/36e5),ue=Math.floor(q/864e5);return re<1?"ë°©ê¸ˆ ì „":re<60?`${re}ë¶„ ì „`:H<24?`${H}ì‹œê°„ ì „`:ue<7?`${ue}ì¼ ì „`:n.toLocaleDateString()}async function L(_){y.value=_,b.value=null,h.value=null,v.value=_.id;try{const n=await fetch(_.url);if(!n.ok)throw new Error("Failed to load sample");const C=await n.blob(),q=new File([C],_.name+".mp3",{type:"audio/mpeg"});h.value=q,S.value=q}catch(n){console.error("Failed to load sample:",n),y.value=null}finally{v.value=null}}function N(_){b.value=_,h.value=null,y.value=null}async function F(_){try{await p(_),await g(),b.value?.id===_&&(b.value=null)}catch(n){console.error("Failed to delete song:",n)}}async function ie(){if(Q())try{await A(),w.value=[],b.value=null}catch(_){console.error("Failed to clear songs:",_)}}ke(g),he(f,_=>{_==="storage"&&g()});function G(){D.value?.click()}function Z(_){const n=_.target;n.files?.[0]&&V(n.files[0])}function ne(_){_.dataTransfer?.files?.[0]&&V(_.dataTransfer.files[0])}async function V(_){S.value=_,h.value=_,b.value=null,y.value=null;try{await u(_)}catch(n){console.error("Failed to save to recent songs:",n)}}async function Q(){if(f.value==="storage"&&b.value){const _=new File([b.value.blob],b.value.name,{type:b.value.blob.type||"audio/mpeg"});m("select",_)}else h.value&&m("select",h.value)}return(_,n)=>(I(),E("div",st,[t("div",ot,[t("button",{class:de({active:f.value==="samples"}),onClick:n[0]||(n[0]=C=>f.value="samples")},"SAMPLES",2),t("button",{class:de({active:f.value==="upload"}),onClick:n[1]||(n[1]=C=>f.value="upload")},"UPLOAD",2),t("button",{class:de({active:f.value==="youtube"}),onClick:n[2]||(n[2]=C=>f.value="youtube")},"GUIDE",2),t("button",{class:de({active:f.value==="storage"}),onClick:n[3]||(n[3]=C=>f.value="storage")},"RECENT",2)]),f.value==="samples"?(I(),E("div",nt,[n[6]||(n[6]=t("p",{class:"section-desc"},"CC0 ë¬´ë£Œ ìŒì•… - ì €ì‘ê¶Œ ê±±ì • ì—†ì´ ë°”ë¡œ í”Œë ˆì´!",-1)),t("div",lt,[(I(!0),E(_e,null,Ae(P.value,C=>(I(),E("div",{key:C.id,class:de(["sample-item",{selected:y.value?.id===C.id,loading:v.value===C.id}]),onClick:q=>L(C)},[t("div",rt,[t("span",ut,j(C.name),1),t("span",ct,j(C.genre)+" â€¢ "+j(C.duration),1)]),v.value===C.id?(I(),E("span",dt,"â—†")):J("",!0)],10,it))),128))])])):f.value==="upload"?(I(),E("div",ft,[t("div",{class:"drop-zone",onDragover:n[4]||(n[4]=we(()=>{},["prevent"])),onDrop:we(ne,["prevent"]),onClick:G},[S.value?(I(),E("p",pt,j(S.value.name),1)):(I(),E("p",vt,"DROP FILE HERE"))],32),t("input",{type:"file",ref_key:"fileInput",ref:D,accept:"audio/*",style:{display:"none"},onChange:Z},null,544)])):f.value==="youtube"?(I(),E("div",mt,[t("div",gt,[n[11]||(n[11]=t("h3",{class:"guide-title"},"ğŸµ YouTube MP3 ë³€í™˜ ê°€ì´ë“œ",-1)),n[12]||(n[12]=t("p",{class:"guide-desc"},[K("ì €ì‘ê¶Œ ë³´í˜¸ë¥¼ ìœ„í•´ ì§ì ‘ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤."),t("br"),K("ì•„ë˜ ë°©ë²•ìœ¼ë¡œ MP3 íŒŒì¼ì„ ì¤€ë¹„í•´ì£¼ì„¸ìš”.")],-1)),t("div",ht,[n[10]||(n[10]=Oe('<div class="step" data-v-3347f0dd><span class="step-num" data-v-3347f0dd>1</span><div class="step-content" data-v-3347f0dd><strong data-v-3347f0dd>YouTube ì˜ìƒ URL ë³µì‚¬</strong><p data-v-3347f0dd>ì›í•˜ëŠ” ìŒì•… ì˜ìƒì˜ ì£¼ì†Œë¥¼ ë³µì‚¬í•˜ì„¸ìš”</p></div></div><div class="step" data-v-3347f0dd><span class="step-num" data-v-3347f0dd>2</span><div class="step-content" data-v-3347f0dd><strong data-v-3347f0dd>MP3 ë³€í™˜ ì‚¬ì´íŠ¸ ì´ìš©</strong><p data-v-3347f0dd>ì•„ë˜ ì‚¬ì´íŠ¸ì—ì„œ MP3ë¡œ ë³€í™˜í•˜ì„¸ìš”</p><div class="converter-links" data-v-3347f0dd><a href="https://y2mate.com" target="_blank" rel="noopener" class="converter-link" data-v-3347f0dd><span class="link-icon" data-v-3347f0dd>ğŸ”—</span> Y2Mate </a><a href="https://ytmp3.cc" target="_blank" rel="noopener" class="converter-link" data-v-3347f0dd><span class="link-icon" data-v-3347f0dd>ğŸ”—</span> YTMP3 </a><a href="https://loader.to" target="_blank" rel="noopener" class="converter-link" data-v-3347f0dd><span class="link-icon" data-v-3347f0dd>ğŸ”—</span> Loader.to </a></div></div></div>',2)),t("div",yt,[n[9]||(n[9]=t("span",{class:"step-num"},"3",-1)),t("div",wt,[n[7]||(n[7]=t("strong",null,"MP3 íŒŒì¼ ì—…ë¡œë“œ",-1)),n[8]||(n[8]=t("p",null,"ë‹¤ìš´ë¡œë“œí•œ MP3 íŒŒì¼ì„ UPLOAD íƒ­ì—ì„œ ì—…ë¡œë“œí•˜ì„¸ìš”",-1)),t("button",{class:"go-upload-btn",onClick:n[5]||(n[5]=C=>f.value="upload")},"UPLOAD íƒ­ìœ¼ë¡œ ì´ë™ â†’")])])]),n[13]||(n[13]=t("div",{class:"warning-box"},[t("span",{class:"warning-icon"},"âš ï¸"),t("p",null,[K("ì´ìƒí•œ ìŠ¤íŒ¸ ì‚¬ì´íŠ¸ê°€ ë‚˜ì˜¬ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ìë™ìœ¼ë¡œ ì—´ë¦¬ëŠ” ì‚¬ì´íŠ¸ëŠ” ë°”ë¡œ ë‹«ì•„ì£¼ì„¸ìš”."),t("br"),K("2ë²ˆì •ë„ ë‹«ìœ¼ë©´ ë‹¤ìš´ë¡œë“œê°€ ë©ë‹ˆë‹¤.")])],-1))])])):f.value==="storage"?(I(),E("div",bt,[n[15]||(n[15]=t("p",{class:"section-desc"},"ìµœê·¼ ì‚¬ìš©í•œ ë…¸ë˜ (ìµœëŒ€ 20ê³¡)",-1)),w.value.length>0?(I(),E("div",St,[(I(!0),E(_e,null,Ae(w.value,C=>(I(),E("div",{key:C.id,class:de(["storage-item",{selected:b.value?.id===C.id}]),onClick:q=>N(C)},[t("div",At,[t("span",Mt,j(C.name),1),t("span",kt,j(i(C.addedAt)),1)]),t("button",{class:"delete-btn",onClick:we(q=>F(C.id),["stop"])},"âœ•",8,xt)],10,_t))),128))])):(I(),E("div",Dt,[...n[14]||(n[14]=[t("p",{class:"empty-icon"},"ğŸ“",-1),t("p",{class:"empty-msg"},"ìµœê·¼ ì‚¬ìš©í•œ ë…¸ë˜ê°€ ì—†ìŠµë‹ˆë‹¤",-1),t("p",{class:"empty-hint"},"UPLOAD íƒ­ì—ì„œ ë…¸ë˜ë¥¼ ì¶”ê°€í•˜ë©´ ì—¬ê¸°ì— ê¸°ë¡ë©ë‹ˆë‹¤",-1)])])),w.value.length>0?(I(),E("button",{key:2,class:"clear-all-btn",onClick:ie}," ì „ì²´ ì‚­ì œ ")):J("",!0)])):J("",!0),t("button",{class:"confirm-btn",disabled:!r.value,onClick:Q}," SELECT ",8,Tt)]))}}),Ct=Object.assign(xe(It,[["__scopeId","data-v-3347f0dd"]]),{__name:"SongSelector"}),$t=()=>{const Y=x(null);return{analyzeAudio:async(m,f,S)=>{S&&S({step:"ì˜¤ë””ì˜¤ í—¤ë”ë¥¼ ì½ëŠ” ì¤‘...",percent:5}),Y.value||(Y.value=new(window.AudioContext||window.webkitAudioContext));const D=await m.arrayBuffer();S&&S({step:"ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ë””ì½”ë”©í•˜ëŠ” ì¤‘...",percent:15});const h=await Y.value.decodeAudioData(D),u=h.getChannelData(0),a=h.sampleRate,p=Math.floor(a/150);S&&S({step:"ìµœê³  ìŒëŸ‰ì„ íŒŒì•…í•˜ê³  ìˆìŠµë‹ˆë‹¤...",percent:25});for(let o=0;o<u.length;o+=p)Math.abs(u[o]||0);const A=.45-(f-1)/29*.4;S&&S({step:"ë¹„íŠ¸ íŒ¨í„´ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...",percent:35}),S&&S({step:"ë¹„íŠ¸ íŒ¨í„´ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤... (Energy Flux)",percent:35});const w=[];let b=0;const P=Math.floor(a*.05),y=Math.floor(a/100),v=[];let r=0;for(let o=0;o<Math.min(P,u.length);o++)r+=u[o]*u[o];for(let o=0;o<u.length-P;o+=y){const T=Math.sqrt(r/P);v.push({t:o/a,e:T});for(let R=0;R<y;R++){const O=u[o+R]||0,U=u[o+P+R]||0;r=r-O*O+U*U}r<0&&(r=0)}const g=[];for(let o=1;o<v.length;o++){const T=Math.max(0,v[o].e-v[o-1].e);g.push(T)}const i=[];for(let o=0;o<g.length;o++){const T=Math.max(0,o-100),R=Math.min(g.length,o+100);let O=0;for(let ee=T;ee<R;ee++)O+=g[ee];const U=O/(R-T);i.push(U)}const L=1.8-(f-1)/29*.4;for(let o=1;o<g.length-1;o++){const T=g[o],R=i[o],O=v[o].t,U=v[o].e;if(T>R*L&&U>.02&&T>g[o-1]&&T>g[o+1]&&O-b>A&&(w.push(O),b=O),S&&o%1e3===0){const ee=35+o/g.length*40;S({step:"ì •ë°€ ë¹„íŠ¸ ë¶„ì„ ì¤‘... (Adaptive)",percent:Math.floor(ee)})}}console.log(`[AudioAnalyzer] Adaptive Logic Detected ${w.length} beats`),S&&S({step:"ì¥ì• ë¬¼ì„ ìµœì  ë°°ì¹˜í•˜ê³  ìˆìŠµë‹ˆë‹¤...",percent:75});const N=[...w];if(N.length<10){console.log("Too few beats detected, adding fallback beats...");const o=.5;for(let T=0;T<h.duration;T+=o)N.push(T)}N.sort((o,T)=>o-T),S&&S({step:"BPMì„ ë¶„ì„í•˜ëŠ” ì¤‘...",percent:80});let F=120;if(w.length>=4){const o=[];for(let T=1;T<Math.min(w.length,50);T++){const R=w[T]-w[T-1];R>.2&&R<2&&o.push(R)}if(o.length>0){o.sort((O,U)=>O-U);const R=60/o[Math.floor(o.length/2)];F=Math.round(R/5)*5,F=Math.max(60,Math.min(200,F))}}const G=60/F*4;console.log(`[AudioAnalyzer] Detected BPM: ${F}, Measure Length: ${G.toFixed(3)}s`),S&&S({step:"ê³¡ì˜ ë¶„ìœ„ê¸° ë³€í™”ë¥¼ ê°ì§€í•˜ëŠ” ì¤‘...",percent:85});const Z=[],ne=a,V=[];for(let o=0;o<u.length;o+=ne){let T=0;const R=Math.min(u.length,o+ne);for(let O=o;O<R;O++){const U=u[O]??0;T+=U*U}V.push(Math.sqrt(T/(R-o||1)))}const Q=6;let _=0,n=V[0]||.001,C=0,q=0;for(let o=0;o<V.length;o++){const T=V[o]??0;C+=T,q++;const R=o-_,O=Math.abs(T-n)/n;if(R>=Q&&(O>.4||R>=15)){const U=C/q;Z.push({startTime:_,endTime:o,intensity:U}),_=o,C=0,q=0,n=U||.001}}if(_<V.length){const o=q>0?C/q:0;Z.push({startTime:_,endTime:h.duration,intensity:o})}const re=Math.max(...Z.map(o=>o.intensity),.001);Z.forEach(o=>{o.intensity=o.intensity/re}),S&&S({step:"ë³¼ë¥¨ì˜ íë¦„ì„ ë¶„ì„ ì¤‘...",percent:90});const H=[],ue=Math.floor(a/10);let fe=0;for(let o=0;o<u.length;o+=ue){const T=Math.min(u.length,o+ue);let R=0;for(let U=o;U<T;U++){const ee=u[U]||0;R+=ee*ee}const O=Math.sqrt(R/(T-o));H.push(O),O>fe&&(fe=O)}if(fe>0)for(let o=0;o<H.length;o++)H[o]=H[o]/fe;return S&&S({step:"ë§µ ìƒì„±ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!",percent:100}),{buffer:h,obstacles:N,sections:Z,duration:h.duration,bpm:F,measureLength:G,volumeProfile:H}}}},Et={class:"map-preview-modal-overlay"},Lt={class:"map-preview-modal glass-panel"},Rt={class:"modal-header"},Pt={class:"preview-viewport"},Ot=["width"],Bt={class:"info-footer"},pe=.5,Pe=350,Nt=Me({__name:"MapPreviewModal",props:{mapData:{}},emits:["close"],setup(Y,{emit:B}){const m=Y,f=x(null),S=x(null),D=me(()=>m.mapData?.duration||60),h=me(()=>Math.ceil(D.value*Pe*pe)+500),u=()=>{if(!f.value||!m.mapData)return;const a=f.value.getContext("2d");if(!a)return;const p=f.value.width,A=f.value.height;a.fillStyle="#050510",a.fillRect(0,0,p,A),a.strokeStyle="rgba(255, 255, 255, 0.05)",a.lineWidth=1;const w=100*pe;for(let y=0;y<p;y+=w)a.beginPath(),a.moveTo(y,0),a.lineTo(y,A),a.stroke();for(let y=0;y<A;y+=40*pe)a.beginPath(),a.moveTo(0,y),a.lineTo(p,y),a.stroke();a.fillStyle="rgba(255, 0, 255, 0.1)",a.fillRect(0,0,p,140*pe),a.fillStyle="rgba(0, 255, 255, 0.1)";const b=pe,P=1;if(m.mapData.beatTimes&&(a.lineWidth=2,m.mapData.beatTimes.forEach(y=>{const v=y*Pe*b;a.strokeStyle="rgba(255, 255, 0, 0.3)",a.beginPath(),a.moveTo(v,0),a.lineTo(v,A),a.stroke(),a.fillStyle="#ffff00",a.fillRect(v-2,A-20,4,10)})),m.mapData.engineObstacles&&(a.fillStyle="#ff4444",a.strokeStyle="#fff",a.lineWidth=1,m.mapData.engineObstacles.forEach(y=>{const v=y.x*b,r=y.y*P,g=(y.width??50)*b,i=(y.height??50)*P;y.type==="spike"||y.type==="mini_spike"?(a.beginPath(),y.y>300?(a.moveTo(v,r+i),a.lineTo(v+g/2,r),a.lineTo(v+g,r+i)):(a.moveTo(v,r),a.lineTo(v+g/2,r+i),a.lineTo(v+g,r)),a.fill()):a.fillRect(v,r,g,i)})),m.mapData.autoplayLog&&m.mapData.autoplayLog.length>0){if(a.beginPath(),a.strokeStyle="#00ffff",a.lineWidth=4,typeof m.mapData.autoplayLog[0]=="number")for(let v=0;v<m.mapData.autoplayLog.length;v+=4){const r=m.mapData.autoplayLog[v]*b,g=m.mapData.autoplayLog[v+1]*P;v===0?a.moveTo(r,g):a.lineTo(r,g)}else{let v=!0;m.mapData.autoplayLog.forEach(r=>{const g=r.x*b,i=r.y*P;v?(a.moveTo(g,i),v=!1):a.lineTo(g,i)})}a.stroke()}};return ke(()=>{u()}),he(()=>m.mapData,u),(a,p)=>(I(),E("div",Et,[t("div",Lt,[t("div",Rt,[p[1]||(p[1]=Oe('<h2 data-v-5256e216>MAP VISUALIZATION LOGIC</h2><div class="legend" data-v-5256e216><span class="legend-item" data-v-5256e216><span class="color-box note" data-v-5256e216></span> Piano Notes (Beats)</span><span class="legend-item" data-v-5256e216><span class="color-box path" data-v-5256e216></span> Path (Trajectory)</span><span class="legend-item" data-v-5256e216><span class="color-box obstacle" data-v-5256e216></span> Obstacles</span></div>',2)),t("button",{class:"close-btn",onClick:p[0]||(p[0]=A=>a.$emit("close"))},"Ã—")]),t("div",Pt,[t("div",{class:"scroll-container",ref_key:"scrollContainer",ref:S},[t("canvas",{ref_key:"canvas",ref:f,width:h.value,height:720},null,8,Ot)],512)]),t("div",Bt,[t("p",null,"Total Duration: "+j(D.value.toFixed(1))+"s",1),t("p",null,"Total Length: "+j(h.value)+"px",1)])])]))}}),Ft=Object.assign(xe(Nt,[["__scopeId","data-v-5256e216"]]),{__name:"MapPreviewModal"});class Ut{audioContext;constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)}async decodeAudio(B){return await this.audioContext.decodeAudioData(B)}async findOnsets(B,m=10){const f=B.getChannelData(0),S=B.sampleRate,D=Math.floor(S*.025),h=Math.floor(S*.005),u=[];let a=0;for(let r=0;r<Math.min(D,f.length);r++){const g=f[r]||0;a+=g*g}for(let r=0;r<f.length-D;r+=h){const g=Math.sqrt(a/D);u.push({t:r/S,e:g});for(let i=0;i<h;i++){const L=f[r+i]||0,N=f[r+D+i]||0;a=a-L*L+N*N}a<0&&(a=0)}const p=[];for(let r=1;r<u.length;r++){const g=u[r]?.e||0,i=u[r-1]?.e||0,L=Math.max(0,g-i);p.push(L)}const A=[];for(let r=0;r<p.length;r++){const g=Math.max(0,r-100),i=Math.min(p.length,r+100);let L=0;for(let F=g;F<i;F++)L+=p[F]||0;const N=L/(i-g);A.push(N)}const w=[],b=[],P=1.5,y=.1;let v=0;for(let r=1;r<p.length-1;r++){const g=p[r],i=p[r-1],L=p[r+1],N=A[r],F=u[r]?.t;g!==void 0&&i!==void 0&&L!==void 0&&N!==void 0&&F!==void 0&&g>N*P&&g>i&&g>L&&F-v>y&&(w.push(F),b.push(g),v=F)}return{times:w,peaks:b}}}class Gt{engine;analyzer;status="idle";progress=0;log=[];constructor(B){this.engine=B,this.analyzer=new Ut}setStatus(B,m,f){this.status=B,this.progress=m,f&&this.log.push(`[${B}] ${f}`)}async generate(B,m){try{this.setStatus("analyzing_song",10,"Decoding audio...");const f=await this.analyzer.decodeAudio(B);this.setStatus("analyzing_song",20,"Detecting volume spikes...");const D=(await this.analyzer.findOnsets(f,m.difficulty)).times;this.setStatus("analyzing_song",30,`Detected ${D.length} notes (spikes).`),this.setStatus("generating_path",30,"Initial path generation..."),await new Promise(p=>setTimeout(p,500));let h=0,u=0;const a=50;for(;h<.975&&u<a;){this.setStatus("adjusting_path",30+u/a*30,`Attempt ${u+1}: Simulating... Match: ${(h*100).toFixed(1)}%`),this.engine.generateMap(D,m.sections||[],f.duration,m.seed?m.seed+u:u,!0,u,m.bpm||120,m.measureLength||2);const p=this.engine.autoplayLog,A=this.calculateMatchRate(p,D);if(A>h&&(h=A),this.log.push(`Attempt ${u}: Match Rate ${(A*100).toFixed(2)}%`),h>=.975)break;u++,await new Promise(w=>setTimeout(w,10))}return h<.9?this.log.push(`Warning: Could not reach 97.5%. Best: ${(h*100).toFixed(2)}%`):this.log.push(`Success: Reached ${(h*100).toFixed(2)}% verify rate.`),this.setStatus("generating_map",70,"Finalizing map objects..."),this.setStatus("adjusting_map",80,"Optimizing obstacles..."),await new Promise(p=>setTimeout(p,200)),this.setStatus("saving_map",90,"Preparing map data..."),await new Promise(p=>setTimeout(p,200)),this.setStatus("completed",100,"Ready to save."),!0}catch(f){return this.setStatus("failed",0,`Error: ${f.message}`),console.error(f),!1}}calculateMatchRate(B,m){if(!B||B.length===0||m.length===0)return 0;const f=[];let S=!1;for(const a of B)a.holding!==void 0&&a.holding!==S&&(f.push(a.time),S=a.holding);let D=0;const h=.05,u=[...f];for(const a of m){let p=-1,A=h;for(let w=0;w<u.length;w++){const b=Math.abs(u[w]-a);b<A&&(A=b,p=w)}p!==-1&&(D++,u.splice(p,1))}return D/m.length}}const qt={class:"play-page"},zt={key:0,class:"setup-container"},jt={key:0,class:"processing-overlay"},Vt={class:"loader-content"},Yt={class:"progress-bar"},Wt={key:0,class:"time-left"},Ht={key:1},Xt={key:2,class:"failure-log"},Jt={class:"fail-tag"},Kt={key:1,class:"desc"},Zt={key:2,class:"desc map-notice"},Qt={class:"difficulty-select"},ea={class:"diff-header"},ta={class:"slider-container"},aa={key:1,class:"setup-container"},sa={class:"processing-overlay"},oa={class:"loader-content"},na={class:"progress-bar"},la={class:"status-text"},ia={class:"smart-gen-logs"},ra={key:3,class:"mode-modal-overlay"},ua={class:"mode-modal glass-panel"},ca={class:"mode-header-row"},da={class:"mode-options"},fa={key:0,class:"rec-badge"},va="umm_audio_db",ve="audio_files",pa=Me({__name:"play",setup(Y){const B=Ye(),m=x("upload"),f=x(null),{analyzeAudio:S}=$t(),D=x(!1),h=x([]),u=x(0),a=x(""),p=x(null),A=me(()=>h.value.slice(-6)),w=x(null),b=x([]),P=x([]),y=x(!1),v=x({step:"",percent:0}),r=x(0),g=x(0),i=x(null),L=x(null),N=x(null),{user:F}=Ge(),ie=Ve(),G=x(!1),Z=x(!1),ne=x(!1),V=x(!1),Q=x(!1),_=x(!1),n=x(1),C=me(()=>n.value<8?"EASY":n.value<16?"NORMAL":n.value<24?"HARD":"IMPOSSIBLE"),q=s=>s<8?"#00ff88":s<16?"#ffff00":s<24?"#ff8800":"#ff0000",re=s=>s>=60?0:Math.max(0,(60-s)/10),H=async s=>{if(G.value=!1,V.value=s==="practice",Q.value=s==="tutorial",s==="tutorial"){if(localStorage.setItem("umm_guide_seen","true"),_.value=!1,i.value&&(!i.value.autoplayLog||i.value.autoplayLog.length===0)){console.log("[Tutorial] Generating AI path for existing map...");const e=new Se({difficulty:i.value.difficulty||5,density:1,portalFrequency:.15});i.value.engineObstacles&&(e.obstacles=i.value.engineObstacles.map(d=>({...d}))),i.value.enginePortals&&(e.portals=i.value.enginePortals.map(d=>({...d}))),e.totalLength=(i.value.duration||120)*e.baseSpeed+1e3,e.computeAutoplayLog(200,360)&&e.autoplayLog.length>0&&(i.value.autoplayLog=e.autoplayLog,console.log("[Tutorial] AI Path Generated with",e.autoplayLog.length,"points"))}m.value="play"}else m.value="play"},ue=async s=>{if(!(s instanceof File)&&s.type==="storage"){const c=s.data;if(i.value=c.mapData,b.value=c.mapData.beatTimes,P.value=c.mapData.sections,n.value=c.mapData.difficulty,c.mapData.audioData){const d=new(window.AudioContext||window.webkitAudioContext),k=await(await fetch(c.mapData.audioData)).arrayBuffer();w.value=await d.decodeAudioData(k),G.value=!0}else if(c.mapData._id){console.log("Loading recent map audio from IndexedDB...",c.mapData._id);try{const d=await Ie(c.mapData._id);if(d){const l=new(window.AudioContext||window.webkitAudioContext),k=await d.arrayBuffer();w.value=await l.decodeAudioData(k),G.value=!0}else alert("ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (IDB Miss)")}catch(d){console.error(d)}}else alert("ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");return}const e=s;f.value=e,y.value=!0,r.value=Date.now(),Z.value=!1;try{const c=new(window.AudioContext||window.webkitAudioContext);v.value={step:"SONG ANALYSIS",percent:0};const d=await S(e,n.value,W=>{if(v.value={step:"SONG ANALYSIS",percent:W.percent},W.percent>5){const ge=(Date.now()-r.value)/1e3,ce=ge/(W.percent/100);g.value=Math.max(0,ce-ge)}});if(w.value=d.buffer,b.value=d.obstacles,P.value=d.sections,d.duration<10){alert("10ì´ˆ ì´ìƒì˜ ë…¸ë˜ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤. (í˜„ì¬: "+d.duration.toFixed(1)+"ì´ˆ)"),y.value=!1;return}const l=d.duration,k=d.obstacles,M=d.sections,z=re(l),te=Math.min(30,n.value+z);z>.5&&console.log(`[Difficulty] Short song detected. Adjusted difficulty: ${n.value} -> ${te.toFixed(2)}`);const $=new Se({difficulty:te,density:1,portalFrequency:.15}),se=Date.now()+Math.floor(Math.random()*1e6);let oe=!1,le=null;for(let W=0;;W++){const ge=W===0?"MOVEMENT PATH GENERATION":"FIXING IMPOSSIBLE PARTS...";v.value={step:ge,percent:W%10*10},W===0&&await new Promise(X=>setTimeout(X,600));let ce;if(W>0&&L.value&&le){const X=L.value.x,Ce=(le.autoplayLog||[]).find(Ue=>Ue.x>=X),$e=Ce?Ce.time:X/350,Fe=te>=16?15:30,Ee=Math.max(0,$e-Fe);console.log(`[SmartGen] Resuming from ${Ee.toFixed(2)}s (Fail at ${$e.toFixed(2)}s)`),ce={time:Ee,stateEvents:le.stateEvents,beatActions:le.beatActions,obstacles:le.obstacles,portals:le.portals}}const Ne=ce?{...ce,obstacles:[...ce.obstacles],portals:[...ce.portals]}:void 0;if($.generateMap(k,M,l,se+W,!1,W,d.bpm,d.measureLength,d.volumeProfile,Ne),oe=await $.computeAutoplayLogAsync(200,360,X=>{v.value.percent=Math.floor(X*100)}),oe){v.value={step:"MAP GENERATION",percent:100},await new Promise(X=>setTimeout(X,500)),v.value={step:"MAP ADJUSTMENT",percent:100},await new Promise(X=>setTimeout(X,500)),v.value={step:"MAP SAVING",percent:100},L.value=null;break}if($.validationFailureInfo&&(L.value={x:Math.floor($.validationFailureInfo.x),y:Math.floor($.validationFailureInfo.y),rawObstacles:$.validationFailureInfo.nearObstacles},We(()=>O()),le={stateEvents:[...$.lastStateEvents],beatActions:[...$.lastBeatActions],obstacles:[...$.obstacles],portals:[...$.portals],autoplayLog:[...$.autoplayLog]}),await new Promise(X=>setTimeout(X,10)),W>50){console.warn("Max retries reached.");break}}if(oe)await new Promise(W=>setTimeout(W,500)),i.value={title:e.name.substring(0,100),difficulty:n.value,seed:se,engineObstacles:$.obstacles,enginePortals:$.portals,autoplayLog:$.autoplayLog,duration:l,beatTimes:k,sections:M,bpm:d.bpm,measureLength:d.measureLength,audioData:null},await U(i.value),fe(i.value),v.value.step="COMPLETED";else throw new Error("ì§€ë‚˜ê°ˆ ìˆ˜ ìˆëŠ” ë§µì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");setTimeout(()=>{y.value=!1,G.value=!0},500)}catch(c){console.error(c),y.value=!1,alert(c.message||"ì˜¤ë””ì˜¤ ë¶„ì„ ë˜ëŠ” ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}},fe=async s=>{const e=JSON.parse(localStorage.getItem("umm_recent_maps")||"[]"),c={id:Date.now(),name:s.title,timestamp:Date.now(),mapData:{...s,audioData:null}};e.unshift(c),localStorage.setItem("umm_recent_maps",JSON.stringify(e.slice(0,10)))},o=()=>{m.value="play"},T=()=>{sessionStorage.getItem("umm_is_test")?(sessionStorage.removeItem("umm_is_test"),B.push("/editor")):(m.value="upload",G.value=!1,V.value=!1,Q.value=!1)},R=async(s,e)=>{m.value="smart_gen",D.value=!0,h.value=[];const c=new Se;p.value=c;const d=new Gt(c),l=Qe(()=>{h.value=[...d.log],u.value=d.progress,a.value=d.status},100),k=await d.generate(s,e);clearInterval(l),k?(i.value={...e,engineObstacles:c.obstacles,enginePortals:c.portals,autoplayLog:c.autoplayLog},setTimeout(()=>{D.value=!1,m.value="play",sessionStorage.setItem("umm_edit_map",JSON.stringify(i.value))},1500)):(alert("Generation failed to reach target accuracy."),D.value=!1,m.value="upload")},O=()=>{if(!N.value||!L.value)return;const s=N.value.getContext("2d");if(!s)return;const{x:e,y:c,rawObstacles:d}=L.value,l=N.value.width,k=N.value.height;s.fillStyle="#050510",s.fillRect(0,0,l,k);const M=.5,z=e-l/2/M,te=360-k/2/M;s.strokeStyle="rgba(255,255,255,0.05)";for(let $=0;$<l;$+=20)s.beginPath(),s.moveTo($,0),s.lineTo($,k),s.stroke();d.forEach($=>{s.save(),s.translate(($.x-z)*M,($.y-te)*M),$.angle&&s.rotate($.angle*Math.PI/180),s.fillStyle=$.type==="spike"?"#ff4444":"#555",s.strokeStyle="#ff00ff",s.lineWidth=1;const se=$.width*M,oe=$.height*M;$.type==="spike"?(s.beginPath(),$.y>300?(s.moveTo(0,oe),s.lineTo(se/2,0),s.lineTo(se,oe)):(s.moveTo(0,0),s.lineTo(se/2,oe),s.lineTo(se,0)),s.fill(),s.stroke()):(s.fillRect(0,0,se,oe),s.strokeRect(0,0,se,oe)),s.restore()}),s.fillStyle="#fff",s.shadowBlur=10,s.shadowColor="#00ffff",s.beginPath(),s.arc((e-z)*M,(c-te)*M,5,0,Math.PI*2),s.fill()},U=async s=>{if(!Z.value&&F.value&&!(V.value||Q.value)&&!(!f.value&&!i.value?.audioUrl))try{const e={title:(f.value?.name||i.value?.title||"Unknown Map").substring(0,100),difficulty:s.difficulty,seed:b.value.length*777+Math.floor(s.duration*100),beatTimes:b.value,sections:P.value,engineObstacles:s.engineObstacles,enginePortals:s.enginePortals,autoplayLog:s.autoplayLog,duration:s.duration,creatorName:F.value?.username||"Guest",isShared:!1};let c=null,d=!1;f.value&&w.value?(e.audioUrl=`/audio/${f.value.name}`,console.log(`[Audio] Trimming audio from ${w.value.duration}s to ${s.duration}s`),c=await Xe(w.value,s.duration),c.length>Je?(console.log(`[Audio] Trimmed audio (${(c.length/1024/1024).toFixed(2)}MB) exceeds limit, will use chunked upload`),d=!0):e.audioData=c):i.value?.audioUrl&&(e.audioUrl=i.value.audioUrl,i.value.audioData&&i.value.audioData.length<100*1024*1024&&(e.audioData=i.value.audioData)),d&&(e.audioData=null,e.audioChunks=[]);const l=await $fetch("/api/maps",{method:"POST",body:e});if(Z.value=!0,console.log(`[Database] Map successfully saved. ID: ${l._id}`),i.value&&(i.value._id=l._id),d&&c){console.log("[Audio] Starting chunked upload...");const k=Ke(c,Ze);for(let M=0;M<k.length;M++)console.log(`[Audio] Uploading chunk ${M+1}/${k.length}...`),await $fetch(`/api/maps/${l._id}/audio-chunk`,{method:"POST",body:{chunkIndex:M,chunkData:k[M],totalChunks:k.length}});console.log(`[Audio] All ${k.length} chunks uploaded successfully!`)}if(!e.audioData&&!d&&f.value){console.log("Saving original audio to local IndexedDB for fast auto-load...");try{await Be(l._id,f.value),console.log("Audio successfully saved to local IndexedDB!")}catch(k){console.error("Failed to save to IndexedDB",k)}}}catch(e){console.error("Failed to save map auto-registration:",e);const c=e.response?._data||{};if(c.statusMessage==="MUSIC_NOT_IN_SERVER"){const d=c.data?.guide||"ê³¡ ì¶”ê°€ê°€ í•„ìš”í•©ë‹ˆë‹¤.",l=c.data?.contact||"ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.";alert(`${d}

ë¬¸ì˜ì²˜: ${l}`)}}},ee=async s=>{if(!i.value?._id||(!V.value&&!Q.value&&s.score>(i.value.bestScore||0)&&(i.value.bestScore=s.score),V.value)||!F.value)return;const e=Q.value?"tutorial_mode":i.value?._id;if(e)try{(await $fetch(`/api/maps/${e}/record`,{method:"POST",body:{score:s.score,progress:s.progress,username:F.value?.username||"Guest"}})).updated&&console.log(`[Record] New best record: ${s.score}`)}catch(c){console.error("Failed to update record:",c)}},De=async s=>{i.value=s,b.value=s.beatTimes||[],P.value=s.sections||[],n.value=s.difficulty||10;const e=new(window.AudioContext||window.webkitAudioContext),c=e.createBuffer(1,Math.max(1,e.sampleRate*(s.duration||10)),e.sampleRate);w.value=c,sessionStorage.getItem("umm_is_tutorial")==="true"?(sessionStorage.removeItem("umm_is_tutorial"),H("tutorial")):G.value=!0};async function ye(){localStorage.getItem("umm_guide_seen")||(_.value=!0,G.value=!0);const e=sessionStorage.getItem("umm_load_map"),c=sessionStorage.getItem("umm_smart_gen")==="true";if(e)try{const l=JSON.parse(e);if(sessionStorage.removeItem("umm_load_map"),c&&sessionStorage.removeItem("umm_smart_gen"),i.value=l,b.value=l.beatTimes,P.value=l.sections,n.value=l.difficulty,l.audioData||l.audioUrl)try{const k=window.AudioContext||window.webkitAudioContext,M=new k;let z=null;if(l.audioData)z=await(await fetch(l.audioData)).arrayBuffer();else if(l.audioUrl){const te=await fetch(l.audioUrl);te.ok&&(z=await te.arrayBuffer())}if(z)if(w.value=await M.decodeAudioData(z),c){R(z,l);return}else{G.value=!0;return}}catch(k){console.error("Audio load error",k)}c?(alert("Smart Gen requires audio!"),m.value="upload"):await De(l);return}catch(l){console.error("Failed to parse session map:",l)}const d=ie.query.map||ie.query.mapId;if(d)try{y.value=!0;const l=await $fetch(`/api/maps/${d}`);if(l)if(i.value=l,b.value=l.beatTimes,P.value=l.sections,n.value=l.difficulty,l.audioData||l.audioUrl)try{let k=null;if(l.audioData&&(console.log("Loading audio from Base64 Data..."),k=await(await fetch(l.audioData)).arrayBuffer()),!k){console.log("Checking local IndexedDB for audio...");try{const M=await Ie(l._id);M&&(console.log("Found audio in local DB!"),k=await M.arrayBuffer())}catch(M){console.warn("IndexedDB check failed",M)}}if(!k&&l.audioUrl){console.log("Loading audio from URL:",l.audioUrl);try{const M=await fetch(l.audioUrl);M.ok?k=await M.arrayBuffer():console.warn("Audio URL fetch failed:",M.status)}catch(M){console.warn("Audio URL fetch error",M)}}if(k){const M=window.AudioContext||window.webkitAudioContext,z=new M;w.value=await z.decodeAudioData(k),G.value=!0}else console.log("Could not find audio source. Prompting user."),alert(`ì˜¤ë””ì˜¤ íŒŒì¼ì„ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì„œë²„/ë¡œì»¬ ì €ì¥ì†Œ ì—†ìŒ)
ì›ë³¸ ìŒì•… íŒŒì¼ì„ ë‹¤ì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.`)}catch(k){console.warn("Auto-load failed, waiting for user file",k),alert("ì˜¤ë””ì˜¤ ë¡œë”© ì‹¤íŒ¨. íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”.")}else await De(l)}catch(l){console.error("Failed to load map:",l)}finally{y.value=!1}}ke(ye),he(()=>ie.query.map,s=>{s&&ye()}),he(()=>ie.query.mapId,s=>{s&&ye()});const Te=()=>new Promise((s,e)=>{const c=indexedDB.open(va,1);c.onupgradeneeded=d=>{const l=d.target.result;l.objectStoreNames.contains(ve)||l.createObjectStore(ve)},c.onsuccess=d=>s(d.target.result),c.onerror=d=>e(d)}),Be=async(s,e)=>{const c=await Te();return new Promise((d,l)=>{const z=c.transaction(ve,"readwrite").objectStore(ve).put(e,s);z.onsuccess=()=>d(),z.onerror=()=>l(z.error)})},Ie=async s=>{const e=await Te();return new Promise((c,d)=>{const M=e.transaction(ve,"readonly").objectStore(ve).get(s);M.onsuccess=()=>c(M.result),M.onerror=()=>d(M.error)})};return(s,e)=>{const c=Ct,d=He;return I(),E("div",qt,[e[24]||(e[24]=t("div",{class:"background-anim"},null,-1)),m.value==="upload"?(I(),E("div",zt,[y.value?(I(),E("div",jt,[t("div",Vt,[e[8]||(e[8]=t("div",{class:"wave-loader"},"â—†",-1)),t("h2",null,j(v.value.step||"ë§µ ìƒì„± ì¤‘..."),1),t("div",Yt,[t("div",{class:"fill",style:be({width:v.value.percent+"%",animation:"none"})},null,4)]),g.value>0?(I(),E("p",Wt,"ì˜ˆìƒ ë‚¨ì€ ì‹œê°„: ì•½ "+j(Math.ceil(g.value))+"ì´ˆ",1)):v.value.percent>0?(I(),E("p",Ht,"ê±°ì˜ ë‹¤ ë˜ì—ˆìŠµë‹ˆë‹¤...")):J("",!0),L.value?(I(),E("div",Xt,[t("span",Jt,"CRITICAL BLOCKAGE AT "+j(L.value.x),1),t("canvas",{ref_key:"failCanvas",ref:N,width:"300",height:"150",class:"fail-preview"},null,512),e[7]||(e[7]=t("div",{class:"fail-details"}," AI failed to find a path through this section. ",-1))])):J("",!0)])])):J("",!0),e[14]||(e[14]=t("div",{class:"header-icon"},"â—†",-1)),e[15]||(e[15]=t("h1",{class:"title"},"ULTRA MUSIC MANIA",-1)),i.value?(I(),E("p",Zt,[e[9]||(e[9]=K(" ë¡œë“œëœ ë§µ: ",-1)),t("strong",null,j(i.value.title),1),e[10]||(e[10]=t("br",null,null,-1)),e[11]||(e[11]=K(" ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ ì´ ë§µì— ì‚¬ìš©ëœ ë…¸ë˜ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”. ",-1))])):(I(),E("p",Kt,"ìŒì•… íŒŒì¼ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ë§µì´ ìƒì„±ë©ë‹ˆë‹¤")),qe(c,{onSelect:ue}),t("div",Qt,[t("div",ea,[e[12]||(e[12]=t("label",null,"ë‚œì´ë„ ì„¤ì •:",-1)),t("span",{class:"diff-value",style:be({color:q(n.value)})},j(C.value)+" ("+j(n.value)+") ",5)]),t("div",ta,[ze(t("input",{type:"range",min:"1",max:"30","onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),class:"diff-slider"},null,512),[[je,n.value,void 0,{number:!0}]]),e[13]||(e[13]=t("div",{class:"slider-marks"},[t("span",null,"EASY"),t("span",null,"NORMAL"),t("span",null,"HARD"),t("span",null,"INSANE")],-1))])])])):J("",!0),m.value==="smart_gen"?(I(),E("div",aa,[t("div",sa,[t("div",oa,[e[16]||(e[16]=t("div",{class:"wave-loader"},"âœ¨",-1)),e[17]||(e[17]=t("h2",null,"SMART GENERATION",-1)),t("div",na,[t("div",{class:"fill",style:be({width:u.value+"%"})},null,4)]),t("p",la,j(a.value?a.value.toUpperCase().replace("_"," "):"PREPARING...")+" ("+j(u.value)+"%)",1),t("div",ia,[(I(!0),E(_e,null,Ae(A.value,(l,k)=>(I(),E("div",{key:k,class:"log-entry"},j(l),1))),128))])])])])):J("",!0),m.value==="play"&&!G.value?(I(),Le(d,{key:2,audioBuffer:w.value,obstacles:b.value,sections:P.value,loadMap:i.value,difficulty:n.value,practiceMode:V.value,tutorialMode:Q.value,onRetry:o,onExit:T,onMapReady:U,onRecordUpdate:ee,onChangeMode:e[1]||(e[1]=l=>G.value=!0)},null,8,["audioBuffer","obstacles","sections","loadMap","difficulty","practiceMode","tutorialMode"])):J("",!0),G.value?(I(),E("div",ra,[t("div",ua,[t("div",ca,[e[18]||(e[18]=t("h2",null,"SELECT GAME MODE",-1)),t("button",{class:"debug-btn",onClick:e[2]||(e[2]=l=>ne.value=!0),title:"View Map Logic"}," ğŸ” Map Logic ")]),t("div",da,[t("button",{onClick:e[3]||(e[3]=l=>H("practice")),class:"mode-btn practice"},[...e[19]||(e[19]=[t("div",{class:"mode-icon"},"ğŸ› ï¸",-1),t("h3",null,"PRACTICE MODE",-1),t("p",null,[K("ì²´í¬í¬ì¸íŠ¸ ì‚¬ìš© ê°€ëŠ¥"),t("br"),K("ê¸°ë¡ ë¯¸ì €ì¥")],-1)])]),t("button",{onClick:e[4]||(e[4]=l=>H("normal")),class:"mode-btn normal"},[...e[20]||(e[20]=[t("div",{class:"mode-icon"},"ğŸµ",-1),t("h3",null,"NORMAL MODE",-1),t("p",null,[K("í‘œì¤€ í”Œë ˆì´"),t("br"),K("ë­í‚¹ ê¸°ë¡ ì €ì¥")],-1)])]),t("button",{onClick:e[5]||(e[5]=l=>H("tutorial")),class:de(["mode-btn tutorial",{recommended:_.value}])},[e[21]||(e[21]=t("div",{class:"mode-icon"},"ğŸ“",-1)),_.value?(I(),E("div",fa,"RECOMMENDED")):J("",!0),e[22]||(e[22]=t("h3",null,"TUTORIAL MODE",-1)),e[23]||(e[23]=t("p",null,[K("ê²Œì„ ê°€ì´ë“œ"),t("br"),K("ê¸°ì´ˆ ë°°ìš°ê¸°")],-1))],2)])])])):J("",!0),ne.value?(I(),Le(Ft,{key:4,mapData:i.value,onClose:e[6]||(e[6]=l=>ne.value=!1)},null,8,["mapData"])):J("",!0)])}}}),_a=xe(pa,[["__scopeId","data-v-cfb206ea"]]);export{_a as default};
