import{e as je,f as et,r as c,i as tt,j as lt,C as at,c as p,a as n,k as E,d as te,p as M,v as S,t as w,B as Se,n as L,F as H,l as oe,s as nt,x as st,m as ot,g as it,o as f}from"./Cgo8w6rr.js";import{G as fe,d as ut}from"./DGfNucPJ.js";import{C as Ee,s as rt}from"./CUbsk6PR.js";import{_ as vt}from"./DlAUqK2U.js";const dt={class:"editor-page"},ct={class:"editor-header glass-panel"},pt={class:"left"},ft={class:"map-meta"},gt={class:"creator"},ht={class:"center"},mt={class:"transport-controls"},yt=["disabled"],wt={key:0},bt={key:0},xt=["disabled"],kt={key:0},Tt={key:0},Mt={key:0},St={key:1},Et={class:"right"},Ot={class:"config-summary"},_t={class:"stat"},At={class:"stat"},Pt={key:0,class:"drawer-header"},Lt={key:1},Ct={class:"object-list"},Dt=["onClick"],It={class:"symbol"},Rt={class:"name"},Nt=["onClick"],Ut={class:"symbol"},Bt={class:"name"},Vt={class:"grid-info"},Yt={class:"timeline-container"},Gt=["max"],Xt={key:0,class:"drawer-header"},$t={key:1},Wt={key:2,class:"properties-list"},Ft={class:"prop-group"},Ht={class:"prop-val-static"},Jt={class:"prop-group"},zt={class:"input-pair"},Kt={class:"prop-group"},Zt={class:"input-pair"},qt={class:"prop-group"},Qt={class:"rotation-controls"},jt={class:"input-pair"},el={key:0,class:"prop-group"},tl=["value"],ll={class:"input-pair"},al={key:0},nl={key:1,class:"hint-text"},sl={key:2,class:"children-list"},ol={key:3,class:"properties-list"},il={class:"prop-group"},ul={class:"prop-val-static"},rl={key:4,class:"empty-selection"},vl={class:"audio-settings prop-group"},dl={class:"audio-upload"},cl={key:0,class:"audio-hint"},pl={key:0,class:"modal-overlay"},fl={class:"modal-box glass-panel"},gl={class:"progress-section"},hl={class:"progress-bar"},ml={class:"status-text"},yl={class:"log-console"},wl={class:"modal-actions"},bl=["disabled"],xl=je({__name:"editor",setup(kl){const ge=it(),{user:he}=et(),J=new fe,i=c({title:"NEW UNTITLED MAP",duration:60,difficulty:15,engineObstacles:[],enginePortals:[],beatTimes:[],sections:[],seed:0,bpm:120,measureLength:2}),V=c(60*350+500),g=c(0),h=c(1),o=c([]),z=c("spike"),K=c(!0),Oe=c(null),x=c(null),me=c(null),ie=["spike","block","saw","mini_spike","laser","spike_ball","v_laser","mine","orb","slope","triangle","steep_triangle","piston_v","falling_spike","hammer","rotor","cannon","spark_mine","laser_beam","crusher_jaw","swing_blade","growing_spike","planet","star","invisible_wall","fake_block"],_e=["gravity_yellow","gravity_blue","speed_0.25","speed_0.5","speed_1","speed_2","speed_3","speed_4","mini_pink","mini_green","teleport_in","teleport_out"],Ae=e=>J.getPortalSymbol(e)||"â– ",Pe=e=>J.getPortalSymbol(e),_=c([]),A=c(-1),Y=c([]),C=c(!1),D=c(!1),ue=c(0),Z=c(200),re=c(360),O=c([]);let G=0,I=null,le=null,P=null;const X=c(!1),b=c({x1:0,y1:0,x2:0,y2:0}),k=c(!1),R=c(!0),N=c(!0),ve=()=>{const e=k.value;k.value=window.innerWidth<=1024,!e&&k.value?(R.value=!1,N.value=!1):e&&!k.value&&(R.value=!0,N.value=!0)},ye=c(!1),Le=c([]),de=c(0),Ce=c(""),De=c(!1),$=c(!1),q=c(!1),Ie=e=>({idle:"IDLE",analyzing_song:"SONG ANALYSIS",generating_path:"MOVEMENT PATH GENERATION",adjusting_path:"MOVEMENT PATH ADJUSTMENT",generating_map:"MAP GENERATION",adjusting_map:"MAP ADJUSTMENT",saving_map:"MAP SAVING",completed:"COMPLETED",failed:"FAILED"})[e]||e.toUpperCase().replace("_"," "),U=()=>{const e=JSON.stringify(i.value);_.value[A.value]!==e&&(_.value=_.value.slice(0,A.value+1),_.value.push(e),_.value.length>50?_.value.shift():A.value++)},Re=()=>{A.value>0&&(A.value--,i.value=JSON.parse(_.value[A.value]))},Ne=()=>{A.value<_.value.length-1&&(A.value++,i.value=JSON.parse(_.value[A.value]))};let ce=!1,ae=!1,ne=!1,W="",we=0,be=0,pe=new Map;const Ue=(e,t,a)=>{const u=10/h.value;return Math.abs(e-a.x)<u&&Math.abs(t-a.y)<u?"tl":Math.abs(e-(a.x+a.width))<u&&Math.abs(t-a.y)<u?"tr":Math.abs(e-a.x)<u&&Math.abs(t-(a.y+a.height))<u?"bl":Math.abs(e-(a.x+a.width))<u&&Math.abs(t-(a.y+a.height))<u?"br":null},Be=e=>{if(e.button===1){ce=!0,we=e.clientX,be=g.value,e.preventDefault();return}if(e.button===2){if(!x.value)return;X.value=!0;const l=x.value.getBoundingClientRect(),s=x.value.width/l.width,m=x.value.height/l.height,y=(e.clientX-l.left)*s/h.value+g.value,T=(e.clientY-l.top)*m/h.value;b.value={x1:y,y1:T,x2:y,y2:T},e.preventDefault();return}if(e.button!==0||!x.value)return;const t=x.value.getBoundingClientRect(),a=x.value.width/t.width,u=x.value.height/t.height;let r=(e.clientX-t.left)*a/h.value+g.value,d=(e.clientY-t.top)*u/h.value;if(C.value&&(r=Math.round(r/25)*25,d=Math.round(d/25)*25),o.value.length===1){const l=Ue(r,d,o.value[0]);if(l){ne=!0,W=l;return}}const v=Xe(r,d);if(v){if(C.value){const l=o.value.indexOf(v);l===-1?o.value.push(v):o.value.splice(l,1)}else o.value.includes(v)||(o.value=[v]);o.value.includes(v)&&(ae=!0,pe.clear(),o.value.forEach(l=>{pe.set(l,{x:l.x-r,y:l.y-d})}))}else C.value||(o.value=[]),$e(r,d),U()},Ve=e=>{if(!x.value)return;const t=x.value.getBoundingClientRect(),a=x.value.width/t.width,u=x.value.height/t.height;let r=(e.clientX-t.left)*a/h.value+g.value,d=(e.clientY-t.top)*u/h.value;const v=r,l=d;if(C.value&&!X.value&&(r=Math.round(r/25)*25,d=Math.round(d/25)*25),ce){const s=e.clientX-we;g.value=Math.max(0,be-s/h.value)}else if(X.value)b.value.x2=v,b.value.y2=l;else if(ne&&o.value.length===1){const s=o.value[0];if(W==="br")s.width=Math.max(10,r-s.x),s.height=Math.max(10,d-s.y);else if(W==="bl"){const m=s.x+s.width;s.x=Math.min(m-10,r),s.width=m-s.x,s.height=Math.max(10,d-s.y)}else if(W==="tr"){const m=s.y+s.height;s.y=Math.min(m-10,d),s.height=m-s.y,s.width=Math.max(10,r-s.x)}else if(W==="tl"){const m=s.x+s.width,y=s.y+s.height;s.x=Math.min(m-10,r),s.y=Math.min(y-10,d),s.width=m-s.x,s.height=y-s.y}}else ae&&o.value.forEach(s=>{const m=pe.get(s);if(m){let y=v+m.x,T=l+m.y;C.value&&(y=Math.round(y/25)*25,T=Math.round(T/25)*25),s.x=y,s.y=T,"initialY"in s&&(s.initialY=T)}})},Ye=()=>{if(X.value){const e=Math.min(b.value.x1,b.value.x2),t=Math.max(b.value.x1,b.value.x2),a=Math.min(b.value.y1,b.value.y2),u=Math.max(b.value.y1,b.value.y2),r=v=>{const l=v.x,s=v.x+v.width,m=v.y,y=v.y+v.height;return!(s<e||l>t||y<a||m>u)},d=[...i.value.engineObstacles.filter(r),...i.value.enginePortals.filter(r)];o.value=d,X.value=!1}else if(ae){if(o.value.length===1){const e=o.value[0];if(!["falling_spike","growing_spike","piston_v","v_laser","laser_beam","boss","star"].includes(e.type)){const a=e.x+e.width/2,u=e.y+e.height/2;let r=null;for(const d of i.value.engineObstacles)if(d!==e&&(d.type==="star"||d.type==="planet")&&a>=d.x&&a<=d.x+d.width&&u>=d.y&&u<=d.y+d.height){r=d;break}r&&(console.log(`Attaching ${e.type} to ${r.type}`),r.children||(r.children=[]),i.value.engineObstacles=i.value.engineObstacles.filter(d=>d!==e),r.children.push(e),e.parentId="attached")}}U()}else ne&&U();ce=!1,ae=!1,ne=!1,W=""},Ge=e=>{if(e.ctrlKey){e.preventDefault();const t=e.deltaY>0?.9:1.1;h.value=Math.max(.1,Math.min(5,h.value*t))}else g.value=Math.max(0,g.value+e.deltaY)},Xe=(e,t)=>{for(const a of i.value.engineObstacles)if(e>=a.x&&e<=a.x+a.width&&t>=a.y&&t<=a.y+a.height)return a;for(const a of i.value.enginePortals)if(e>=a.x&&e<=a.x+a.width&&t>=a.y&&t<=a.y+a.height)return a;return null},$e=(e,t)=>{const a=z.value;if(ie.includes(a)){const u={x:e,y:t-25,width:50,height:50,type:a,angle:0,initialY:t-25,movement:{type:"none",range:0,speed:0,phase:0}};i.value.engineObstacles.push(u),o.value=[u]}else{const u={x:e,y:t-30,width:60,height:80,type:a,angle:0,activated:!1};i.value.enginePortals.push(u),o.value=[u]}},F=e=>(e.customData||(e.customData={}),e.customData),We=e=>{if(o.value.length!==1)return;const t=o.value[0];t.movement||(t.movement={type:"none",range:0,speed:0,phase:0}),!(t.type==="rotor"&&e!=="rotate")&&(t.type==="piston_v"&&e!=="updown"||(e==="none"?t.movement.type="none":(t.movement.type=e,t.movement.range===0&&(t.movement.range=100),t.movement.speed===0&&(t.movement.speed=1))))},se=()=>{o.value.length!==0&&(i.value.engineObstacles=i.value.engineObstacles.filter(e=>!o.value.includes(e)),i.value.enginePortals=i.value.enginePortals.filter(e=>!o.value.includes(e)),o.value=[],U())},xe=()=>{V.value=i.value.duration*350+500},Fe=()=>{let e=0;const t=i.value.engineObstacles||[],a=i.value.enginePortals||[];for(let v=0;v<t.length;v++){const l=t[v].x+t[v].width;l>e&&(e=l)}for(let v=0;v<a.length;v++){const l=a[v].x+a[v].width;l>e&&(e=l)}const r=Math.max(2e3,e+1500),d=Math.max(10,Math.ceil((r-500)/350));i.value.duration!==d&&(i.value.duration=d,xe())};tt([()=>i.value.engineObstacles,()=>i.value.enginePortals],()=>{Fe()},{deep:!0});const He=()=>me.value?.click(),Je=e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=u=>{i.value.audioData=u.target?.result,i.value.audioUrl=`/audio/${t.name}`,(!i.value.title||i.value.title==="NEW UNTITLED MAP")&&(i.value.title=t.name.split(".")[0])},a.readAsDataURL(t)},ze=async()=>{if(D.value){D.value=!1,Q();return}if(!P&&typeof window<"u"&&(P=new(window.AudioContext||window.webkitAudioContext)),i.value.audioData&&!le&&P)try{const u=await(await fetch(i.value.audioData)).arrayBuffer();le=await P.decodeAudioData(u)}catch(a){console.error("Failed to decode preview audio",a)}const e=new fe;e.obstacles=[...i.value.engineObstacles],e.portals=[...i.value.enginePortals],e.totalLength=V.value;const t=await e.computeAutoplayLogAsync(200,360,()=>{});i.value.autoplayLog=e.autoplayLog,!(!t&&!confirm("AI cannot find a clear path! Preview anyway?"))&&(D.value=!0,ue.value=0,O.value=[],g.value=0,Ke())},Ke=()=>{!le||!P||(Q(),I=P.createBufferSource(),I.buffer=le,I.connect(P.destination),I.start(0))},Q=()=>{if(I){try{I.stop()}catch{}I=null}},Ze=async()=>{if(!$.value){$.value=!0,console.log("Starting map test simulation...");try{const e=new fe;e.obstacles=[...i.value.engineObstacles],e.portals=[...i.value.enginePortals],e.totalLength=V.value,console.log("Computing autoplay log..."),await new Promise(a=>setTimeout(a,50));const t=await e.computeAutoplayLogAsync(200,360,a=>{});if(i.value.autoplayLog=e.autoplayLog,console.log("Autoplay computation result:",t),!t&&!confirm("AI cannot finish this map! Play anyway?")){$.value=!1;return}sessionStorage.setItem("umm_edit_map",JSON.stringify(i.value)),sessionStorage.setItem("umm_is_test","true"),sessionStorage.setItem("umm_load_map",JSON.stringify(i.value)),ge.push("/play")}catch(e){console.error("Test map error:",e),alert("An error occurred during test preparation: "+e.message),$.value=!1}}},qe=async()=>{if(!q.value){q.value=!0;try{const e=!i.value._id,t=e?"/api/maps":`/api/maps/${i.value._id}`,a=e?"POST":"PATCH";e&&(i.value.creatorName=he.value?.username||"Guest");const u=i.value.audioData;if(u&&u.length>Ee){const r=rt(u,Ee),d={...i.value,audioData:null,audioChunks:[]},l=(await $fetch(t,{method:a,body:d}))._id;e&&(i.value._id=l);for(let s=0;s<r.length;s++)await $fetch(`/api/maps/${l}/audio-chunk`,{method:"POST",body:{chunkIndex:s,chunkData:r[s],totalChunks:r.length}});alert(`Map saved! (Audio: ${r.length} chunks)`)}else{const r=await $fetch(t,{method:a,body:i.value});e&&(i.value._id=r._id),alert("Map saved successfully!")}}catch(e){console.error("Save error:",e);const t=e.response?._data?.statusMessage||e.message||"Unknown error";alert(`Failed to save map: ${t}`)}finally{q.value=!1}}};let ke;const Te=()=>{if(!x.value)return;const e=x.value.getContext("2d");if(!e)return;const t=x.value.width,a=x.value.height,u=performance.now()/1e3;e.clearRect(0,0,t,a),e.fillStyle="#050510",e.fillRect(0,0,t,a),e.save(),e.scale(h.value,h.value),e.translate(-g.value,0),e.strokeStyle="rgba(255, 255, 255, 0.05)";const r=50,d=Math.floor(g.value/r)*r;for(let l=d;l<g.value+t/h.value;l+=r)e.beginPath(),e.moveTo(l,0),e.lineTo(l,a/h.value),e.stroke();for(let l=0;l<a/h.value;l+=r)e.beginPath(),e.moveTo(g.value,l),e.lineTo(g.value+t/h.value,l),e.stroke();if(e.fillStyle="rgba(255, 0, 0, 0.1)",e.fillRect(g.value,0,t/h.value,140),e.fillRect(g.value,580,t/h.value,a/h.value-580),e.strokeStyle="#ff3333",e.lineWidth=3,e.beginPath(),e.moveTo(g.value,140),e.lineTo(g.value+t/h.value,140),e.stroke(),e.beginPath(),e.moveTo(g.value,580),e.lineTo(g.value+t/h.value,580),e.stroke(),e.fillStyle="#ff3333",e.font="bold 12px Outfit",e.fillText("CEILING BOUNDARY",g.value+10,130),e.fillText("FLOOR BOUNDARY",g.value+10,575),i.value.autoplayLog&&i.value.autoplayLog.length>1){e.save(),e.strokeStyle="rgba(255, 0, 255, 0.4)",e.lineWidth=4,e.setLineDash([10,5]),e.beginPath(),e.moveTo(i.value.autoplayLog[0].x,i.value.autoplayLog[0].y);for(let l=1;l<i.value.autoplayLog.length;l++)e.lineTo(i.value.autoplayLog[l].x,i.value.autoplayLog[l].y);e.stroke(),e.setLineDash([]),e.globalAlpha=1,e.restore()}i.value.enginePortals.forEach(l=>{const s=J.getPortalColor(l.type);e.save(),l.angle&&(e.translate(l.x+l.width/2,l.y+l.height/2),e.rotate(l.angle*Math.PI/180),e.translate(-(l.x+l.width/2),-(l.y+l.height/2))),e.fillStyle=s,e.shadowBlur=15,e.shadowColor=s,e.globalAlpha=.2,e.fillRect(l.x,l.y,l.width,l.height),e.globalAlpha=1,e.strokeStyle="#fff",e.lineWidth=2,e.strokeRect(l.x,l.y,l.width,l.height),e.fillStyle="#fff",e.font="bold 20px Outfit",e.textAlign="center",e.fillText(J.getPortalSymbol(l.type),l.x+l.width/2,l.y+l.height/2+8),e.restore(),o.value.includes(l)&&(e.strokeStyle="#00ffff",e.lineWidth=3,e.strokeRect(l.x-5,l.y-5,l.width+10,l.height+10)),K.value&&(e.strokeStyle="#00ff00",e.lineWidth=1,e.setLineDash([4,4]),e.strokeRect(l.x,l.y,l.width,l.height),e.setLineDash([]))}),i.value.engineObstacles.forEach(l=>{e.save(),l.movement&&l.movement.type==="updown"&&(e.strokeStyle="rgba(0, 255, 255, 0.1)",e.beginPath(),e.moveTo(l.x+l.width/2,(l.initialY||l.y)-l.movement.range),e.lineTo(l.x+l.width/2,(l.initialY||l.y)+l.movement.range),e.stroke());const s=J.getObstacleStateAt(l,u),m=l.x,y=s.y,T=s.angle;ut(e,l,m,y,u,!0,T),K.value&&(e.strokeStyle="#00ff00",e.lineWidth=1,e.setLineDash([4,4]),e.strokeRect(m,y,l.width,l.height),e.setLineDash([])),e.restore()});const v=V.value;if(e.strokeStyle="#00ff88",e.lineWidth=8,e.setLineDash([15,10]),e.beginPath(),e.moveTo(v,0),e.lineTo(v,a/h.value),e.stroke(),e.setLineDash([]),e.fillStyle="#00ff88",e.font="900 32px Outfit",e.textAlign="center",e.fillText("FINISH LINE",v,100),e.textAlign="left",o.value.forEach(l=>{if(e.save(),e.strokeStyle="#00ffff",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(l.x,l.y,l.width,l.height),e.setLineDash([]),o.value.length===1){e.fillStyle="#fff";const s=6/h.value;e.fillRect(l.x-s,l.y-s,s*2,s*2),e.fillRect(l.x+l.width-s,l.y-s,s*2,s*2),e.fillRect(l.x-s,l.y+l.height-s,s*2,s*2),e.fillRect(l.x+l.width-s,l.y+l.height-s,s*2,s*2)}e.restore()}),X.value){e.fillStyle="rgba(0, 255, 255, 0.1)",e.strokeStyle="#00ffff",e.lineWidth=1;const l=Math.min(b.value.x1,b.value.x2),s=Math.min(b.value.y1,b.value.y2),m=Math.abs(b.value.x2-b.value.x1),y=Math.abs(b.value.y2-b.value.y1);e.fillRect(l,s,m,y),e.strokeRect(l,s,m,y)}if(D.value){if(O.value.length>1){e.save(),e.beginPath(),e.moveTo(O.value[0].x,O.value[0].y);for(let s=1;s<O.value.length;s++)e.lineTo(O.value[s].x,O.value[s].y);e.strokeStyle="rgba(0, 255, 255, 0.6)",e.lineWidth=14/h.value,e.lineCap="round",e.lineJoin="round",e.stroke(),e.restore()}const l=i.value.autoplayLog;if(l&&l.length>0){const s=performance.now()/1e3;G||(G=s);const m=s-G;G=s,ue.value+=m;const y=200+ue.value*350;let T=l[0];for(let B=0;B<l.length;B++){if(l[B].x>=y){if(B>0){const ee=l[B-1],Me=l[B],Qe=(y-ee.x)/(Me.x-ee.x);T={x:y,y:ee.y+(Me.y-ee.y)*Qe,holding:ee.holding}}else T=l[B];break}T=l[l.length-1]}Z.value=T.x,re.value=T.y,O.value.push({x:Z.value,y:re.value}),O.value.length>500&&O.value.shift(),g.value=Math.max(0,Z.value-200),e.save(),e.fillStyle=T.holding?"#ff00ff":"#00ffff",e.shadowBlur=25,e.shadowColor=e.fillStyle,e.beginPath(),e.arc(Z.value,re.value,18/h.value,0,Math.PI*2),e.fill(),e.restore(),Z.value>=V.value&&(D.value=!1,G=0,Q())}}else G=0;e.restore(),ke=requestAnimationFrame(Te)},j=e=>{o.value.forEach(t=>{"angle"in t&&(t.angle=(t.angle||0)+e,t.angle<0&&(t.angle+=360),t.angle>=360&&(t.angle-=360))}),U()};return lt(()=>{const e=sessionStorage.getItem("umm_edit_map");e&&(i.value=JSON.parse(e),sessionStorage.removeItem("umm_edit_map"),xe()),U(),typeof window<"u"&&!P&&(P=new(window.AudioContext||window.webkitAudioContext)),Te();const t=u=>{if(!(u.target instanceof HTMLInputElement||u.target instanceof HTMLTextAreaElement||u.target instanceof HTMLSelectElement))if(u.key==="Shift"&&(C.value=!0),u.ctrlKey||u.metaKey)if(u.key==="c")o.value.length>0&&(Y.value=o.value.map(r=>({...r,_id:void 0})));else if(u.key==="x")o.value.length>0&&(Y.value=o.value.map(r=>({...r,_id:void 0})),se());else if(u.key==="v"){if(Y.value.length>0){const r=Math.min(...Y.value.map(v=>v.x));Math.min(...Y.value.map(v=>v.y));const d=Y.value.map(v=>{const l={...v,x:g.value+(v.x-r)+100,y:v.y};return ie.includes(l.type)?i.value.engineObstacles.push(l):i.value.enginePortals.push(l),l});o.value=d,U()}}else u.key==="z"?Re():u.key==="y"&&Ne();else u.key==="Delete"||u.key==="Backspace"?o.value.length>0&&se():u.key.toLowerCase()==="r"&&o.value.length>0&&j(45)},a=u=>{u.key==="Shift"&&(C.value=!1)};window.addEventListener("keydown",t),window.addEventListener("keyup",a),at(()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",a),cancelAnimationFrame(ke),Q(),Q(),window.removeEventListener("resize",ve)}),ve(),window.addEventListener("resize",ve)}),(e,t)=>(f(),p("div",dt,[t[59]||(t[59]=n("div",{class:"background-anim"},null,-1)),n("header",ct,[n("div",pt,[t[29]||(t[29]=n("h1",{class:"title"},[te("MAP_ARCHITECT "),n("span",{class:"version"},"v2.0")],-1)),n("div",ft,[M(n("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>i.value.title=a),placeholder:"Map Title",class:"map-title-input"},null,512),[[S,i.value.title]]),n("span",gt,"BY: "+w(Se(he)?.username||"Guest"),1)])]),n("div",ht,[n("div",mt,[k.value?(f(),p("button",{key:0,onClick:t[1]||(t[1]=a=>R.value=!R.value),class:L(["control-btn mobile-toggle",{active:R.value}])}," ðŸŽ¨ ",2)):E("",!0),n("button",{onClick:Ze,class:"control-btn test",disabled:$.value},[t[30]||(t[30]=n("span",{class:"icon"},"â–¶",-1)),t[31]||(t[31]=te()),k.value?E("",!0):(f(),p("span",wt,w($.value?"TESTING...":"TEST"),1))],8,yt),n("button",{onClick:ze,class:L(["control-btn tutorial",{active:D.value}])},[t[32]||(t[32]=n("span",{class:"icon"},"ðŸŽ“",-1)),t[33]||(t[33]=te()),k.value?E("",!0):(f(),p("span",bt,w(D.value?"STOP":"TUTORIAL"),1))],2),n("button",{onClick:qe,class:"control-btn save",disabled:q.value},[t[34]||(t[34]=n("span",{class:"icon"},"ðŸ’¾",-1)),t[35]||(t[35]=te()),k.value?E("",!0):(f(),p("span",kt,w(q.value?"SAVING...":"SAVE"),1))],8,xt),n("button",{onClick:t[2]||(t[2]=a=>K.value=!K.value),class:L(["control-btn",{active:K.value}])},[t[36]||(t[36]=n("span",{class:"icon"},"â›¶",-1)),t[37]||(t[37]=te()),k.value?E("",!0):(f(),p("span",Tt,"HITBOX"))],2),k.value?(f(),p("button",{key:1,onClick:t[3]||(t[3]=a=>N.value=!N.value),class:L(["control-btn mobile-toggle",{active:N.value}])}," âš™ï¸ ",2)):E("",!0),n("button",{onClick:t[4]||(t[4]=a=>Se(ge).push("/maps")),class:"control-btn exit"},[k.value?(f(),p("span",St,"âœ•")):(f(),p("span",Mt,"EXIT"))])])]),n("div",Et,[n("div",Ot,[n("span",_t,"OBJ: "+w(i.value.engineObstacles.length),1),n("span",At,"PORT: "+w(i.value.enginePortals.length),1)])])]),n("div",{class:L(["main-layout",{"is-mobile":k.value}])},[n("aside",{class:L(["sidebar left-sidebar glass-panel",{"mobile-drawer":k.value,open:R.value}])},[k.value?(f(),p("div",Pt,[t[38]||(t[38]=n("h3",null,"PALETTE",-1)),n("button",{onClick:t[5]||(t[5]=a=>R.value=!1),class:"close-drawer"},"âœ•")])):(f(),p("h3",Lt,"PALETTE")),n("div",Ct,[(f(),p(H,null,oe(ie,a=>n("div",{key:a,class:L(["palette-item",{selected:z.value===a}]),onClick:u=>z.value=a},[n("div",It,w(Ae(a)),1),n("span",Rt,w(a.split("_").join(" ").toUpperCase()),1)],10,Dt)),64)),t[39]||(t[39]=n("div",{class:"separator"},"PORTALS",-1)),(f(),p(H,null,oe(_e,a=>n("div",{key:a,class:L(["palette-item portal",{selected:z.value===a}]),onClick:u=>z.value=a},[n("div",Ut,w(Pe(a)),1),n("span",Bt,w(a.split("_").join(" ").toUpperCase()),1)],10,Nt)),64))])],2),n("main",{class:"workspace glass-panel",ref_key:"workspaceRef",ref:Oe,onMousedown:Be,onMousemove:Ve,onMouseup:Ye,onWheel:Ge,onContextmenu:t[7]||(t[7]=nt(()=>{},["prevent"]))},[n("canvas",{ref_key:"canvasRef",ref:x,width:"1200",height:"600",class:"editor-canvas"},null,512),n("div",Vt,[n("span",null,"ZOOM: "+w((h.value*100).toFixed(0))+"%",1),n("span",null,"X: "+w(Math.floor(g.value)),1)]),n("div",Yt,[M(n("input",{type:"range",min:"0",max:V.value,"onUpdate:modelValue":t[6]||(t[6]=a=>g.value=a),class:"timeline-slider"},null,8,Gt),[[S,g.value,void 0,{number:!0}]])])],544),n("aside",{class:L(["sidebar right-sidebar glass-panel",{"mobile-drawer":k.value,open:N.value}])},[k.value?(f(),p("div",Xt,[t[40]||(t[40]=n("h3",null,"PROPERTIES",-1)),n("button",{onClick:t[8]||(t[8]=a=>N.value=!1),class:"close-drawer"},"âœ•")])):(f(),p("h3",$t,"PROPERTIES")),o.value.length===1?(f(),p("div",Wt,[n("div",Ft,[t[41]||(t[41]=n("label",null,"TYPE",-1)),n("span",Ht,w(o.value[0].type.toUpperCase()),1)]),n("div",Jt,[t[42]||(t[42]=n("label",null,"POSITION X / Y",-1)),n("div",zt,[M(n("input",{type:"number","onUpdate:modelValue":t[9]||(t[9]=a=>o.value[0].x=a)},null,512),[[S,o.value[0].x,void 0,{number:!0}]]),M(n("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=a=>o.value[0].y=a)},null,512),[[S,o.value[0].y,void 0,{number:!0}]])])]),n("div",Kt,[t[43]||(t[43]=n("label",null,"SIZE W / H",-1)),n("div",Zt,[M(n("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=a=>o.value[0].width=a)},null,512),[[S,o.value[0].width,void 0,{number:!0}]]),M(n("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=a=>o.value[0].height=a)},null,512),[[S,o.value[0].height,void 0,{number:!0}]])])]),n("div",qt,[t[44]||(t[44]=n("label",null,"ROTATION (DEG)",-1)),n("div",Qt,[n("button",{onClick:t[13]||(t[13]=a=>j(-45)),title:"Rotate -45",class:"rot-btn"},"â†º"),n("button",{onClick:t[14]||(t[14]=a=>j(45)),title:"Rotate 45",class:"rot-btn"},"â†»"),n("button",{onClick:t[15]||(t[15]=a=>j(90)),title:"Rotate 90",class:"rot-btn"},"90Â°"),n("button",{onClick:t[16]||(t[16]=a=>j(180)),title:"Rotate 180",class:"rot-btn"},"180Â°")]),n("div",jt,[M(n("input",{type:"number","onUpdate:modelValue":t[17]||(t[17]=a=>o.value[0].angle=a)},null,512),[[S,o.value[0].angle,void 0,{number:!0}]]),M(n("input",{type:"range",min:"0",max:"360","onUpdate:modelValue":t[18]||(t[18]=a=>o.value[0].angle=a)},null,512),[[S,o.value[0].angle,void 0,{number:!0}]])])]),o.value[0].movement?(f(),p("div",el,[t[48]||(t[48]=n("label",null,"MOVEMENT TYPE",-1)),n("select",{value:o.value[0].movement.type,onChange:t[19]||(t[19]=a=>We(a.target.value))},[...t[45]||(t[45]=[st('<option value="none" data-v-a5565fde>NONE</option><option value="updown" data-v-a5565fde>UP-DOWN</option><option value="leftright" data-v-a5565fde>LEFT-RIGHT</option><option value="rotate" data-v-a5565fde>ROTATE</option><option value="bounce" data-v-a5565fde>BOUNCE</option>',5)])],40,tl),o.value[0].movement.type!=="none"?(f(),p(H,{key:0},[t[46]||(t[46]=n("label",null,"SPEED / RANGE",-1)),n("div",ll,[M(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[20]||(t[20]=a=>o.value[0].movement.speed=a),placeholder:"Speed"},null,512),[[S,o.value[0].movement.speed,void 0,{number:!0}]]),M(n("input",{type:"number","onUpdate:modelValue":t[21]||(t[21]=a=>o.value[0].movement.range=a),placeholder:"Range"},null,512),[[S,o.value[0].movement.range,void 0,{number:!0}]])]),t[47]||(t[47]=n("label",null,"PHASE OFFSET",-1)),M(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[22]||(t[22]=a=>o.value[0].movement.phase=a)},null,512),[[S,o.value[0].movement.phase,void 0,{number:!0}]])],64)):E("",!0)])):E("",!0),["planet","star"].includes(o.value[0].type)?(f(),p(H,{key:1},[o.value[0].type==="planet"?(f(),p("div",al,[t[49]||(t[49]=n("label",null,"ORBIT MOON COUNT",-1)),M(n("input",{type:"number","onUpdate:modelValue":t[23]||(t[23]=a=>F(o.value[0]).orbitCount=a),placeholder:"0 or 2"},null,512),[[S,F(o.value[0]).orbitCount,void 0,{number:!0}]])])):E("",!0),t[50]||(t[50]=n("label",null,"ORBIT SPEED",-1)),M(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[24]||(t[24]=a=>F(o.value[0]).orbitSpeed=a),placeholder:"Speed"},null,512),[[S,F(o.value[0]).orbitSpeed,void 0,{number:!0}]]),t[51]||(t[51]=n("label",null,"ORBIT DISTANCE",-1)),M(n("input",{type:"number","onUpdate:modelValue":t[25]||(t[25]=a=>F(o.value[0]).orbitDistance=a),placeholder:"Distance"},null,512),[[S,F(o.value[0]).orbitDistance,void 0,{number:!0}]]),o.value[0].type==="star"?(f(),p("div",nl," Drag a Planet onto this Star to attach it! ")):E("",!0),o.value[0].children&&o.value[0].children.length>0?(f(),p("div",sl,[n("label",null,"ATTACHED PLANETS: "+w(o.value[0].children.length),1),(f(!0),p(H,null,oe(o.value[0].children,(a,u)=>(f(),p("div",{key:u,class:"child-item"},[n("span",null,"Planet "+w(u+1),1)]))),128))])):E("",!0)],64)):E("",!0),n("button",{onClick:se,class:"delete-btn"},"DELETE OBJECT")])):o.value.length>1?(f(),p("div",ol,[n("div",il,[t[52]||(t[52]=n("label",null,"MULTIPLE SELECTION",-1)),n("span",ul,w(o.value.length)+" OBJECTS",1)]),n("button",{onClick:se,class:"delete-btn"},"DELETE ALL")])):(f(),p("div",rl," SELECT OBJECTS TO MODIFY ")),t[57]||(t[57]=n("div",{class:"global-settings prop-group"},[n("h3",null,"LEVEL CONFIG")],-1)),n("div",vl,[t[54]||(t[54]=n("h3",null,"AUDIO CONFIG",-1)),t[55]||(t[55]=n("label",null,"BPM",-1)),M(n("input",{type:"number","onUpdate:modelValue":t[26]||(t[26]=a=>i.value.bpm=a)},null,512),[[S,i.value.bpm,void 0,{number:!0}]]),t[56]||(t[56]=n("label",null,"MEASURE LENGTH (S)",-1)),M(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[27]||(t[27]=a=>i.value.measureLength=a)},null,512),[[S,i.value.measureLength,void 0,{number:!0}]]),n("div",dl,[t[53]||(t[53]=n("label",null,"AUDIO FILE",-1)),n("button",{onClick:He,class:"upload-btn"},w(i.value.audioData?"AUDIO LOADED":"UPLOAD MP3"),1),n("input",{type:"file",ref_key:"audioInputRef",ref:me,accept:"audio/*",style:{display:"none"},onChange:Je},null,544),i.value.audioData?(f(),p("p",cl,"Audio embedded in map data")):E("",!0)])])],2)],2),ye.value?(f(),p("div",pl,[n("div",fl,[t[58]||(t[58]=n("h2",null,"SMART MAP GENERATION",-1)),n("div",gl,[n("div",hl,[n("div",{class:"fill",style:ot({width:de.value+"%"})},null,4)]),n("span",ml,w(Ie(Ce.value))+" ("+w(de.value.toFixed(0))+"%)",1)]),n("div",yl,[(f(!0),p(H,null,oe(Le.value,(a,u)=>(f(),p("div",{key:u,class:"log-line"},w(a),1))),128))]),n("div",wl,[n("button",{onClick:t[28]||(t[28]=a=>ye.value=!1),disabled:De.value&&de.value<100,class:"control-btn exit"},"CLOSE",8,bl)])])])):E("",!0)]))}}),Ol=vt(xl,[["__scopeId","data-v-a5565fde"]]);export{Ol as default};
