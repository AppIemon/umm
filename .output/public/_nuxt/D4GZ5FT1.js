import{e as F,f as O,g as B,r as d,h as P,i as V,j as x,c as n,o,a as t,n as b,k as v,F as A,l as U,m as E,t as c,p as S,v as $,q as H}from"./CeYHdBDP.js";import{_ as Y}from"./DlAUqK2U.js";const G={class:"maps-page"},q={class:"container"},z={class:"page-header"},J={class:"tabs"},K={key:0,class:"map-grid"},j={class:"card-header"},Q={key:0,class:"verified-tag"},W={key:1,class:"rating-tag"},X={key:2,class:"rating-tag empty"},Z={class:"date"},tt={class:"map-title"},et={class:"map-info"},at={class:"creator"},st={class:"duration"},nt={class:"actions"},ot=["onClick"],lt=["onClick"],it=["onClick"],ct=["onClick","disabled","title"],rt=["onClick"],dt=["onClick"],ut={key:0,class:"rename-modal"},vt={class:"modal-content glass-panel"},_t={class:"modal-actions"},ht={key:1,class:"rename-modal"},ft={class:"modal-content glass-panel"},pt={class:"rating-info"},yt={class:"rating-slider-container"},gt={class:"modal-actions"},mt={key:2,class:"empty-state"},Ct={key:1,class:"loading-state"},kt=F({__name:"maps",setup(bt){const{user:T}=O(),y=B(),l=d("my"),f=d([]),p=d(!0),r=d(null),_=d(""),i=d(null),u=d(15),g=async()=>{p.value=!0;try{const a=l.value==="my"?T.value?.username||"Guest":void 0,e=l.value==="shared"?"true":void 0;f.value=await $fetch("/api/maps",{query:{creator:a,shared:e}})}catch(a){console.error("Fetch maps error:",a)}finally{p.value=!1}},m=P(()=>f.value),M=async a=>{try{const e=await $fetch(`/api/maps/${a._id}`);sessionStorage.setItem("umm_load_map",JSON.stringify(e)),y.push("/play")}catch{alert("Failed to load map data.")}},R=async a=>{try{const e=await $fetch(`/api/maps/${a._id}`);sessionStorage.setItem("umm_edit_map",JSON.stringify(e)),y.push("/editor")}catch{alert("Failed to load map data.")}},N=async a=>{if(confirm(`Are you sure you want to delete "${a.title}"?`))try{await $fetch(`/api/maps/${a._id}`,{method:"DELETE"}),f.value=f.value.filter(e=>e._id!==a._id)}catch{alert("Map deletion failed.")}},w=a=>{r.value=a,_.value=a.title},C=async()=>{if(!(!r.value||!_.value.trim()))try{const a=await $fetch(`/api/maps/${r.value._id}`,{method:"PATCH",body:{title:_.value.trim()}});r.value.title=a.title,r.value=null}catch{alert("Rename failed.")}},D=async a=>{try{const e=await $fetch(`/api/maps/${a._id}`,{method:"PATCH",body:{isShared:!a.isShared}});a.isShared=e.isShared}catch{alert("Toggle share failed.")}},k=a=>a<8?"#00ff88":a<16?"#ffff00":a<24?"#ff8800":"#ff4444",I=a=>{i.value=a,u.value=Math.round(a.rating)||15},L=async()=>{if(i.value)try{const a=await $fetch(`/api/maps/${i.value._id}/rate`,{method:"POST",body:{rating:u.value}});i.value.rating=a.rating,i.value.ratingCount=a.ratingCount,i.value=null}catch{alert("Rating failed.")}};return V(l,g),x(g),(a,e)=>(o(),n("div",G,[e[9]||(e[9]=t("div",{class:"background-anim"},null,-1)),t("div",q,[t("header",z,[e[6]||(e[6]=t("h1",{class:"title"},"MAP_DATABASE",-1)),t("div",J,[t("button",{class:b(["tab-btn",{active:l.value==="my"}]),onClick:e[0]||(e[0]=s=>l.value="my")}," MY_ENTRIES ",2),t("button",{class:b(["tab-btn",{active:l.value==="shared"}]),onClick:e[1]||(e[1]=s=>l.value="shared")}," GLOBAL_UPLOADS ",2)])]),p.value?(o(),n("div",Ct," ACCESSING DATABASE... ")):(o(),n("div",K,[(o(!0),n(A,null,U(m.value,s=>(o(),n("div",{key:s._id,class:"map-card"},[t("div",j,[t("span",{class:"diff-tag",style:E({color:k(s.difficulty)})}," DIFF: "+c(s.difficulty),5),s.isVerified?(o(),n("span",Q,"✓ VERIFIED")):v("",!0),s.rating>0?(o(),n("span",W," RATE: ★"+c(s.rating.toFixed(1)),1)):(o(),n("span",X," RATE: - ")),t("span",Z,c(new Date(s.createdAt).toLocaleDateString()),1)]),t("h3",tt,c(s.title),1),t("div",et,[t("span",at,"BY: "+c(s.creatorName),1),t("span",st,c(Math.floor(s.duration))+"s",1)]),t("div",nt,[t("button",{onClick:h=>M(s),class:"action-btn play"},"PLAY",8,ot),l.value==="my"?(o(),n(A,{key:0},[t("button",{onClick:h=>R(s),class:"action-btn edit"},"EDIT",8,lt),t("button",{onClick:h=>w(s),class:"action-btn rename"},"RENAME",8,it),t("button",{onClick:h=>D(s),class:"action-btn share",disabled:!s.autoplayLog||s.autoplayLog.length===0,title:!s.autoplayLog||s.autoplayLog.length===0?"AI 검증된 맵만 공유 가능":""},c(s.isShared?"PRIVATE":"SHARE"),9,ct),t("button",{onClick:h=>N(s),class:"action-btn delete"},"DEL",8,rt)],64)):v("",!0),l.value==="shared"&&s.isVerified?(o(),n("button",{key:1,onClick:h=>I(s),class:"action-btn rate"},"RATE",8,dt)):v("",!0)])]))),128)),r.value?(o(),n("div",ut,[t("div",vt,[e[7]||(e[7]=t("h3",null,"RENAME_ENTRY",-1)),S(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),placeholder:"Enter new title...",onKeyup:H(C,["enter"])},null,544),[[$,_.value]]),t("div",_t,[t("button",{onClick:C,class:"confirm"},"CONFIRM"),t("button",{onClick:e[3]||(e[3]=s=>r.value=null),class:"cancel"},"CANCEL")])])])):v("",!0),i.value?(o(),n("div",ht,[t("div",ft,[e[8]||(e[8]=t("h3",null,"RATE_MAP",-1)),t("p",pt,c(i.value.title),1),t("div",yt,[S(t("input",{type:"range",min:"1",max:"30","onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),class:"rating-slider"},null,512),[[$,u.value,void 0,{number:!0}]]),t("span",{class:"rating-value",style:E({color:k(u.value)})},c(u.value),5)]),t("div",gt,[t("button",{onClick:L,class:"confirm"},"SUBMIT"),t("button",{onClick:e[5]||(e[5]=s=>i.value=null),class:"cancel"},"CANCEL")])])])):v("",!0),m.value.length===0?(o(),n("div",mt," NO DATA FOUND IN THIS SECTOR ")):v("",!0)]))])]))}}),St=Y(kt,[["__scopeId","data-v-4c84ede5"]]);export{St as default};
