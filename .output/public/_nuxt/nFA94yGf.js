import{r as y,e as F,f as x,j as M,g as U,c as g,a as s,B as a,t as l,F as A,l as L,s as N,p as k,v as R,o as p,n as B}from"./BrYDLEIV.js";import{_ as V}from"./DlAUqK2U.js";const h=y("#00ffff"),w=y("#ff00ff"),D=y("#ff4444");if(typeof localStorage<"u"){const S=localStorage.getItem("wave_game_settings");if(S)try{const v=JSON.parse(S);h.value=v.playerColor||"#00ffff",w.value=v.trailColor||"#ff00ff",D.value=v.obstacleColor||"#ff4444"}catch{}}const j=()=>{localStorage.setItem("wave_game_settings",JSON.stringify({playerColor:h.value,trailColor:w.value,obstacleColor:D.value}))},K=()=>({playerColor:h,trailColor:w,obstacleColor:D,saveSettings:j}),q="ImpossibleTimingDB",_="songs",G=1,H=()=>{const S=()=>new Promise((c,n)=>{const o=indexedDB.open(q,G);o.onerror=r=>n("IndexedDB error"),o.onupgradeneeded=r=>{const f=r.target.result;f.objectStoreNames.contains(_)||f.createObjectStore(_,{keyPath:"id"})},o.onsuccess=r=>{c(r.target.result)}});return{saveSong:async c=>{const n=await S();return new Promise((o,r)=>{const d=n.transaction([_],"readwrite").objectStore(_),u={id:crypto.randomUUID(),name:c.name,blob:c,date:Date.now()},m=d.add(u);m.onsuccess=()=>o(u),m.onerror=()=>r("Error saving song")})},getSongs:async()=>{const c=await S();return new Promise((n,o)=>{const d=c.transaction([_],"readonly").objectStore(_).getAll();d.onsuccess=()=>{const u=d.result.sort((m,C)=>C.date-m.date);n(u)},d.onerror=()=>o("Error fetching songs")})},deleteSong:async c=>{const n=await S();return new Promise((o,r)=>{const u=n.transaction([_],"readwrite").objectStore(_).delete(c);u.onsuccess=()=>o(),u.onerror=()=>r("Error deleting song")})}}},z={class:"mypage-container"},J={class:"header"},W={class:"content"},$={class:"stats-col"},Y={class:"glass-panel profile-card"},Z={class:"user-id"},Q={class:"rating-display"},X={class:"value"},ss={class:"glass-panel history-section"},ts={key:0,class:"history-list"},es={class:"match-meta"},os={class:"m-date"},ns={class:"m-opp"},as={class:"match-res"},rs={class:"res-tag"},is={class:"m-score"},ls={key:1,class:"empty-state"},cs={class:"upload-section glass-panel"},ds={class:"right-col"},us={class:"settings-section glass-panel"},gs={class:"setting-row"},ps={class:"setting-row"},vs={class:"storage-section glass-panel"},fs={key:0,class:"song-list"},_s={class:"song-info"},Ss={class:"song-name"},ms={class:"song-date"},ys={class:"actions"},Cs=["onClick"],hs={key:1,class:"empty-state"},ws=F({__name:"mypage",setup(S){const v=U(),{saveSong:E,getSongs:T,deleteSong:c}=H(),{user:n}=x(),o=K(),r=y([]),f=y(null);M(async()=>{if(!n.value||n.value.isGuest){alert("Login required to access storage."),v.push("/login");return}await d()});async function d(){try{r.value=await T()}catch(i){console.error(i)}}function u(){f.value?.click()}async function m(i){const t=i.target;t.files&&t.files[0]&&await b(t.files[0])}async function C(i){i.dataTransfer?.files&&i.dataTransfer.files[0]&&await b(i.dataTransfer.files[0])}async function b(i){try{await E(i),await d()}catch{alert("Failed to save song")}}async function P(i){confirm("Delete this track?")&&(await c(i),await d())}function I(i){return new Date(i).toLocaleDateString()}return(i,t)=>(p(),g("div",z,[s("div",J,[t[6]||(t[6]=s("h1",{class:"title"},"PILOT PROFILE",-1)),s("button",{class:"back-btn",onClick:t[0]||(t[0]=e=>a(v).push("/"))},"BACK TO MENU")]),s("div",W,[s("div",$,[s("div",Y,[s("div",Z,"@"+l(a(n)?.username),1),s("div",Q,[t[7]||(t[7]=s("span",{class:"label"},"SKILL RATING",-1)),s("span",X,l(a(n)?.rating||1e3),1)])]),s("div",ss,[t[8]||(t[8]=s("h2",null,"MATCH HISTORY",-1)),a(n)?.matchHistory?.length?(p(),g("div",ts,[(p(!0),g(A,null,L(a(n).matchHistory,(e,O)=>(p(),g("div",{key:O,class:B(["match-item",{win:e.winner===a(n).username}])},[s("div",es,[s("span",os,l(I(new Date(e.date).getTime())),1),s("span",ns,"VS "+l(e.opponent),1)]),s("div",as,[s("span",rs,l(e.winner===a(n).username?"WIN":"LOSS"),1),s("span",{class:B(["m-rating",{plus:e.ratingChange>0}])},l(e.ratingChange>0?"+":"")+l(e.ratingChange),3)]),s("div",is,l(e.myScore.toFixed(0))+"% - "+l(e.opponentScore.toFixed(0))+"%",1)],2))),128))])):(p(),g("div",ls,"NO BATTLE DATA"))]),s("div",cs,[t[10]||(t[10]=s("h2",null,"UPLOAD NEW TRACK",-1)),s("div",{class:"drop-zone",onDragover:t[1]||(t[1]=N(()=>{},["prevent"])),onDrop:N(C,["prevent"]),onClick:u},[...t[9]||(t[9]=[s("p",null,"DROP FILE OR CLICK TO UPLOAD",-1)])],32),s("input",{type:"file",ref_key:"fileInput",ref:f,accept:"audio/*",style:{display:"none"},onChange:m},null,544)])]),s("div",ds,[s("div",us,[t[13]||(t[13]=s("h2",null,"ENGINE CUSTOMIZATION",-1)),s("div",gs,[t[11]||(t[11]=s("label",null,"FIRE PLANET COLOR",-1)),k(s("input",{type:"color","onUpdate:modelValue":t[2]||(t[2]=e=>a(o).fireColor.value=e),onChange:t[3]||(t[3]=(...e)=>a(o).saveSettings&&a(o).saveSettings(...e))},null,544),[[R,a(o).fireColor.value]])]),s("div",ps,[t[12]||(t[12]=s("label",null,"ICE PLANET COLOR",-1)),k(s("input",{type:"color","onUpdate:modelValue":t[4]||(t[4]=e=>a(o).iceColor.value=e),onChange:t[5]||(t[5]=(...e)=>a(o).saveSettings&&a(o).saveSettings(...e))},null,544),[[R,a(o).iceColor.value]])])]),s("div",vs,[s("h2",null,"SAVED TRACKS ("+l(r.value.length)+")",1),r.value.length>0?(p(),g("div",fs,[(p(!0),g(A,null,L(r.value,e=>(p(),g("div",{key:e.id,class:"song-item"},[s("div",_s,[s("span",Ss,l(e.name),1),s("span",ms,l(I(e.date)),1)]),s("div",ys,[s("button",{class:"delete-btn",onClick:O=>P(e.id)},"DELETE",8,Cs)])]))),128))])):(p(),g("div",hs," NO TRACKS SAVED "))])])])]))}}),Ts=V(ws,[["__scopeId","data-v-d107291a"]]);export{Ts as default};
