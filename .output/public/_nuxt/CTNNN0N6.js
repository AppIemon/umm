import{e as P,f as F,g as B,r as d,h as O,i as V,j as x,c as n,o,a as t,n as A,k as u,F as E,l as U,m as M,t as l,p as S,v as $,q as Y}from"./OCD2nr9N.js";import{_ as G}from"./DlAUqK2U.js";const H={class:"maps-page"},q={class:"container"},z={class:"page-header"},J={class:"tabs"},K={key:0,class:"map-grid"},j={class:"card-header"},Q={key:0,class:"verified-tag"},W={key:1,class:"rating-tag"},X={key:2,class:"rating-tag empty"},Z={class:"date"},tt={class:"map-title"},et={class:"map-info"},at={class:"creator"},st={class:"duration"},nt={key:0,class:"my-progress"},ot={class:"actions"},lt=["onClick"],it=["onClick"],rt=["onClick"],ct=["onClick","disabled","title"],dt=["onClick"],ut=["onClick"],vt={key:0,class:"rename-modal"},_t={class:"modal-content glass-panel"},ht={class:"modal-actions"},ft={key:1,class:"rename-modal"},yt={class:"modal-content glass-panel"},pt={class:"rating-info"},gt={class:"rating-slider-container"},mt={class:"modal-actions"},kt={key:2,class:"empty-state"},Ct={key:1,class:"loading-state"},bt=P({__name:"maps",setup(At){const{user:g}=F(),y=B(),i=d("my"),f=d([]),p=d(!0),c=d(null),_=d(""),r=d(null),v=d(15),m=async()=>{p.value=!0;try{const a=i.value==="my"?g.value?.username||"Guest":void 0,e=i.value==="shared"?"true":void 0;f.value=await $fetch("/api/maps",{query:{creator:a,shared:e}})}catch(a){console.error("Fetch maps error:",a)}finally{p.value=!1}},k=O(()=>f.value),T=async a=>{try{const e=await $fetch(`/api/maps/${a._id}`);sessionStorage.setItem("umm_load_map",JSON.stringify(e)),y.push("/play")}catch{alert("Failed to load map data.")}},R=async a=>{try{const e=await $fetch(`/api/maps/${a._id}`);sessionStorage.setItem("umm_edit_map",JSON.stringify(e)),y.push("/editor")}catch{alert("Failed to load map data.")}},D=async a=>{if(confirm(`Are you sure you want to delete "${a.title}"?`))try{await $fetch(`/api/maps/${a._id}`,{method:"DELETE"}),f.value=f.value.filter(e=>e._id!==a._id)}catch{alert("Map deletion failed.")}},N=a=>{c.value=a,_.value=a.title},C=async()=>{if(!(!c.value||!_.value.trim()))try{const a=await $fetch(`/api/maps/${c.value._id}`,{method:"PATCH",body:{title:_.value.trim()}});c.value.title=a.title,c.value=null}catch{alert("Rename failed.")}},w=async a=>{try{const e=await $fetch(`/api/maps/${a._id}`,{method:"PATCH",body:{isShared:!a.isShared}});a.isShared=e.isShared}catch{alert("Toggle share failed.")}},b=a=>a<8?"#00ff88":a<16?"#ffff00":a<24?"#ff8800":"#ff4444",I=a=>{r.value=a,v.value=Math.round(a.rating)||15},L=async()=>{if(r.value)try{const a=await $fetch(`/api/maps/${r.value._id}/rate`,{method:"POST",body:{rating:v.value}});r.value.rating=a.rating,r.value.ratingCount=a.ratingCount,r.value=null}catch{alert("Rating failed.")}};return V(i,m),x(()=>{if(!g.value){alert("Guest cannot access MAP Database. Please Login."),y.push("/");return}m()}),(a,e)=>(o(),n("div",H,[e[9]||(e[9]=t("div",{class:"background-anim"},null,-1)),t("div",q,[t("header",z,[e[6]||(e[6]=t("h1",{class:"title"},"MAP_DATABASE",-1)),t("div",J,[t("button",{class:A(["tab-btn",{active:i.value==="my"}]),onClick:e[0]||(e[0]=s=>i.value="my")}," MY_ENTRIES ",2),t("button",{class:A(["tab-btn",{active:i.value==="shared"}]),onClick:e[1]||(e[1]=s=>i.value="shared")}," GLOBAL_UPLOADS ",2)])]),p.value?(o(),n("div",Ct," ACCESSING DATABASE... ")):(o(),n("div",K,[(o(!0),n(E,null,U(k.value,s=>(o(),n("div",{key:s._id,class:"map-card"},[t("div",j,[t("span",{class:"diff-tag",style:M({color:b(s.difficulty)})}," DIFF: "+l(s.difficulty),5),s.isVerified?(o(),n("span",Q,"✓ VERIFIED")):u("",!0),s.rating>0?(o(),n("span",W," RATE: ★"+l(s.rating.toFixed(1)),1)):(o(),n("span",X," RATE: - ")),t("span",Z,l(new Date(s.createdAt).toLocaleDateString()),1)]),t("h3",tt,l(s.title),1),t("div",et,[t("span",at,"BY: "+l(s.creatorName),1),t("span",st,l(Math.floor(s.duration))+"s",1),s.myBestProgress!==void 0?(o(),n("span",nt,"MY: "+l(Math.floor(s.myBestProgress))+"%",1)):u("",!0)]),t("div",ot,[t("button",{onClick:h=>T(s),class:"action-btn play"},"PLAY",8,lt),i.value==="my"?(o(),n(E,{key:0},[t("button",{onClick:h=>R(s),class:"action-btn edit"},"EDIT",8,it),t("button",{onClick:h=>N(s),class:"action-btn rename"},"RENAME",8,rt),t("button",{onClick:h=>w(s),class:"action-btn share",disabled:!s.autoplayLog||s.autoplayLog.length===0,title:!s.autoplayLog||s.autoplayLog.length===0?"AI 검증된 맵만 공유 가능":""},l(s.isShared?"PRIVATE":"SHARE"),9,ct),t("button",{onClick:h=>D(s),class:"action-btn delete"},"DEL",8,dt)],64)):u("",!0),i.value==="shared"&&s.isVerified?(o(),n("button",{key:1,onClick:h=>I(s),class:"action-btn rate"},"RATE",8,ut)):u("",!0)])]))),128)),c.value?(o(),n("div",vt,[t("div",_t,[e[7]||(e[7]=t("h3",null,"RENAME_ENTRY",-1)),S(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.value=s),placeholder:"Enter new title...",onKeyup:Y(C,["enter"])},null,544),[[$,_.value]]),t("div",ht,[t("button",{onClick:C,class:"confirm"},"CONFIRM"),t("button",{onClick:e[3]||(e[3]=s=>c.value=null),class:"cancel"},"CANCEL")])])])):u("",!0),r.value?(o(),n("div",ft,[t("div",yt,[e[8]||(e[8]=t("h3",null,"RATE_MAP",-1)),t("p",pt,l(r.value.title),1),t("div",gt,[S(t("input",{type:"range",min:"1",max:"30","onUpdate:modelValue":e[4]||(e[4]=s=>v.value=s),class:"rating-slider"},null,512),[[$,v.value,void 0,{number:!0}]]),t("span",{class:"rating-value",style:M({color:b(v.value)})},l(v.value),5)]),t("div",mt,[t("button",{onClick:L,class:"confirm"},"SUBMIT"),t("button",{onClick:e[5]||(e[5]=s=>r.value=null),class:"cancel"},"CANCEL")])])])):u("",!0),k.value.length===0?(o(),n("div",kt," NO DATA FOUND IN THIS SECTOR ")):u("",!0)]))])]))}}),St=G(bt,[["__scopeId","data-v-a06a8dc1"]]);export{St as default};
