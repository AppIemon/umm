import{e as Qe,f as je,r as c,i as et,j as tt,C as lt,c as p,a as n,k as E,d as ee,p as S,v as M,t as w,B as Me,n as L,F as J,l as oe,s as at,x as nt,m as st,g as ot,o as f}from"./DcswZMe2.js";import{G as ge,d as it}from"./B98MRPuF.js";import{C as Ee,s as ut}from"./CUbsk6PR.js";import{_ as rt}from"./DlAUqK2U.js";const vt={class:"editor-page"},dt={class:"editor-header glass-panel"},ct={class:"left"},pt={class:"map-meta"},ft={class:"creator"},gt={class:"center"},ht={class:"transport-controls"},mt=["disabled"],yt={key:0},wt={key:0},bt=["disabled"],xt={key:0},kt={key:0},Tt={key:0},St={key:1},Mt={class:"right"},Et={class:"config-summary"},Ot={class:"stat"},_t={class:"stat"},At={key:0,class:"drawer-header"},Pt={key:1},Lt={class:"object-list"},Ct=["onClick"],Dt={class:"symbol"},It={class:"name"},Rt=["onClick"],Nt={class:"symbol"},Ut={class:"name"},Bt={class:"grid-info"},Vt={class:"timeline-container"},$t=["max"],Yt={key:0,class:"drawer-header"},Gt={key:1},Wt={key:2,class:"properties-list"},Xt={class:"prop-group"},Ft={class:"prop-val-static"},Ht={class:"prop-group"},Jt={class:"input-pair"},zt={class:"prop-group"},Kt={class:"input-pair"},Zt={class:"prop-group"},qt={class:"rotation-controls"},Qt={class:"input-pair"},jt={key:0,class:"prop-group"},el=["value"],tl={class:"input-pair"},ll={key:0},al={key:1,class:"hint-text"},nl={key:2,class:"children-list"},sl={key:3,class:"properties-list"},ol={class:"prop-group"},il={class:"prop-val-static"},ul={key:4,class:"empty-selection"},rl={class:"audio-settings prop-group"},vl={class:"audio-upload"},dl={key:0,class:"audio-hint"},cl={key:0,class:"modal-overlay"},pl={class:"modal-box glass-panel"},fl={class:"progress-section"},gl={class:"progress-bar"},hl={class:"status-text"},ml={class:"log-console"},yl={class:"modal-actions"},wl=["disabled"],bl=Qe({__name:"editor",setup(xl){const he=ot(),{user:me}=je(),C=new ge,i=c({title:"NEW UNTITLED MAP",duration:60,difficulty:15,engineObstacles:[],enginePortals:[],beatTimes:[],sections:[],seed:0,bpm:120,measureLength:2}),$=c(60*350+500),g=c(0),h=c(1),o=c([]),z=c("spike"),K=c(!0),Oe=c(null),x=c(null),ye=c(null),ie=["spike","block","saw","mini_spike","laser","spike_ball","v_laser","mine","orb","slope","triangle","steep_triangle","piston_v","falling_spike","hammer","rotor","cannon","spark_mine","laser_beam","crusher_jaw","swing_blade","growing_spike","planet","star","invisible_wall","fake_block"],_e=["gravity_yellow","gravity_blue","speed_0.25","speed_0.5","speed_1","speed_2","speed_3","speed_4","mini_pink","mini_green","teleport_in","teleport_out"],Ae=e=>C.getPortalSymbol(e)||"â– ",Pe=e=>C.getPortalSymbol(e),_=c([]),A=c(-1),Y=c([]),D=c(!1),I=c(!1),te=c(0),Z=c(200),ue=c(360),O=c([]);let G=0,R=null,le=null,P=null;const W=c(!1),b=c({x1:0,y1:0,x2:0,y2:0}),T=c(!1),N=c(!0),U=c(!0),re=()=>{const e=T.value;T.value=window.innerWidth<=1024,!e&&T.value?(N.value=!1,U.value=!1):e&&!T.value&&(N.value=!0,U.value=!0)},we=c(!1),Le=c([]),ve=c(0),Ce=c(""),De=c(!1),X=c(!1),q=c(!1),Ie=e=>({idle:"IDLE",analyzing_song:"SONG ANALYSIS",generating_path:"MOVEMENT PATH GENERATION",adjusting_path:"MOVEMENT PATH ADJUSTMENT",generating_map:"MAP GENERATION",adjusting_map:"MAP ADJUSTMENT",saving_map:"MAP SAVING",completed:"COMPLETED",failed:"FAILED"})[e]||e.toUpperCase().replace("_"," "),B=()=>{const e=JSON.stringify(i.value);_.value[A.value]!==e&&(_.value=_.value.slice(0,A.value+1),_.value.push(e),_.value.length>50?_.value.shift():A.value++)},Re=()=>{A.value>0&&(A.value--,i.value=JSON.parse(_.value[A.value]))},Ne=()=>{A.value<_.value.length-1&&(A.value++,i.value=JSON.parse(_.value[A.value]))};let de=!1,ae=!1,ne=!1,F="",be=0,xe=0,ce=new Map;const Ue=(e,t,a)=>{const u=10/h.value;return Math.abs(e-a.x)<u&&Math.abs(t-a.y)<u?"tl":Math.abs(e-(a.x+a.width))<u&&Math.abs(t-a.y)<u?"tr":Math.abs(e-a.x)<u&&Math.abs(t-(a.y+a.height))<u?"bl":Math.abs(e-(a.x+a.width))<u&&Math.abs(t-(a.y+a.height))<u?"br":null},Be=e=>{if(e.button===1){de=!0,be=e.clientX,xe=g.value,e.preventDefault();return}if(e.button===2){if(!x.value)return;W.value=!0;const l=x.value.getBoundingClientRect(),s=x.value.width/l.width,m=x.value.height/l.height,y=(e.clientX-l.left)*s/h.value+g.value,k=(e.clientY-l.top)*m/h.value;b.value={x1:y,y1:k,x2:y,y2:k},e.preventDefault();return}if(e.button!==0||!x.value)return;const t=x.value.getBoundingClientRect(),a=x.value.width/t.width,u=x.value.height/t.height;let r=(e.clientX-t.left)*a/h.value+g.value,v=(e.clientY-t.top)*u/h.value;if(D.value&&(r=Math.round(r/25)*25,v=Math.round(v/25)*25),o.value.length===1){const l=Ue(r,v,o.value[0]);if(l){ne=!0,F=l;return}}const d=Ge(r,v);if(d){if(D.value){const l=o.value.indexOf(d);l===-1?o.value.push(d):o.value.splice(l,1)}else o.value.includes(d)||(o.value=[d]);o.value.includes(d)&&(ae=!0,ce.clear(),o.value.forEach(l=>{ce.set(l,{x:l.x-r,y:l.y-v})}))}else D.value||(o.value=[]),We(r,v),B()},Ve=e=>{if(!x.value)return;const t=x.value.getBoundingClientRect(),a=x.value.width/t.width,u=x.value.height/t.height;let r=(e.clientX-t.left)*a/h.value+g.value,v=(e.clientY-t.top)*u/h.value;const d=r,l=v;if(D.value&&!W.value&&(r=Math.round(r/25)*25,v=Math.round(v/25)*25),de){const s=e.clientX-be;g.value=Math.max(0,xe-s/h.value)}else if(W.value)b.value.x2=d,b.value.y2=l;else if(ne&&o.value.length===1){const s=o.value[0];if(F==="br")s.width=Math.max(10,r-s.x),s.height=Math.max(10,v-s.y);else if(F==="bl"){const m=s.x+s.width;s.x=Math.min(m-10,r),s.width=m-s.x,s.height=Math.max(10,v-s.y)}else if(F==="tr"){const m=s.y+s.height;s.y=Math.min(m-10,v),s.height=m-s.y,s.width=Math.max(10,r-s.x)}else if(F==="tl"){const m=s.x+s.width,y=s.y+s.height;s.x=Math.min(m-10,r),s.y=Math.min(y-10,v),s.width=m-s.x,s.height=y-s.y}}else ae&&o.value.forEach(s=>{const m=ce.get(s);if(m){let y=d+m.x,k=l+m.y;D.value&&(y=Math.round(y/25)*25,k=Math.round(k/25)*25),s.x=y,s.y=k,"initialY"in s&&(s.initialY=k)}})},$e=()=>{if(W.value){const e=Math.min(b.value.x1,b.value.x2),t=Math.max(b.value.x1,b.value.x2),a=Math.min(b.value.y1,b.value.y2),u=Math.max(b.value.y1,b.value.y2),r=d=>{const l=d.x,s=d.x+d.width,m=d.y,y=d.y+d.height;return!(s<e||l>t||y<a||m>u)},v=[...i.value.engineObstacles.filter(r),...i.value.enginePortals.filter(r)];o.value=v,W.value=!1}else if(ae){if(o.value.length===1){const e=o.value[0];if(!["falling_spike","growing_spike","piston_v","v_laser","laser_beam","boss","star"].includes(e.type)){const a=e.x+e.width/2,u=e.y+e.height/2;let r=null;for(const v of i.value.engineObstacles)if(v!==e&&(v.type==="star"||v.type==="planet")&&a>=v.x&&a<=v.x+v.width&&u>=v.y&&u<=v.y+v.height){r=v;break}r&&(console.log(`Attaching ${e.type} to ${r.type}`),r.children||(r.children=[]),i.value.engineObstacles=i.value.engineObstacles.filter(v=>v!==e),r.children.push(e),e.parentId="attached")}}B()}else ne&&B();de=!1,ae=!1,ne=!1,F=""},Ye=e=>{if(e.ctrlKey){e.preventDefault();const t=e.deltaY>0?.9:1.1;h.value=Math.max(.1,Math.min(5,h.value*t))}else g.value=Math.max(0,g.value+e.deltaY)},Ge=(e,t)=>{for(const a of i.value.engineObstacles)if(e>=a.x&&e<=a.x+a.width&&t>=a.y&&t<=a.y+a.height)return a;for(const a of i.value.enginePortals)if(e>=a.x&&e<=a.x+a.width&&t>=a.y&&t<=a.y+a.height)return a;return null},We=(e,t)=>{const a=z.value;if(ie.includes(a)){const u={x:e,y:t-25,width:50,height:50,type:a,angle:0,initialY:t-25,movement:{type:"none",range:0,speed:0,phase:0}};i.value.engineObstacles.push(u),o.value=[u]}else{const u={x:e,y:t-30,width:60,height:80,type:a,angle:0,activated:!1};i.value.enginePortals.push(u),o.value=[u]}},H=e=>(e.customData||(e.customData={}),e.customData),Xe=e=>{if(o.value.length!==1)return;const t=o.value[0];t.movement||(t.movement={type:"none",range:0,speed:0,phase:0}),!(t.type==="rotor"&&e!=="rotate")&&(t.type==="piston_v"&&e!=="updown"||(e==="none"?t.movement.type="none":(t.movement.type=e,t.movement.range===0&&(t.movement.range=100),t.movement.speed===0&&(t.movement.speed=1))))},se=()=>{o.value.length!==0&&(i.value.engineObstacles=i.value.engineObstacles.filter(e=>!o.value.includes(e)),i.value.enginePortals=i.value.enginePortals.filter(e=>!o.value.includes(e)),o.value=[],B())},pe=()=>{const e=C.getDynamicBaseSpeed();$.value=i.value.duration*e+500},Fe=()=>{let e=0;const t=i.value.engineObstacles||[],a=i.value.enginePortals||[];for(let l=0;l<t.length;l++){const s=t[l].x+t[l].width;s>e&&(e=s)}for(let l=0;l<a.length;l++){const s=a[l].x+a[l].width;s>e&&(e=s)}const u=C.getDynamicBaseSpeed(),v=Math.max(2e3,e+1500),d=Math.max(10,Math.ceil((v-500)/u));i.value.duration!==d&&(i.value.duration=d,pe())};et([()=>i.value.engineObstacles,()=>i.value.enginePortals,()=>i.value.difficulty],()=>{Fe(),pe()},{deep:!0});const He=()=>ye.value?.click(),Je=e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=u=>{i.value.audioData=u.target?.result,i.value.audioUrl=`/audio/${t.name}`,(!i.value.title||i.value.title==="NEW UNTITLED MAP")&&(i.value.title=t.name.split(".")[0])},a.readAsDataURL(t)},ze=()=>{!le||!P||(Q(),R=P.createBufferSource(),R.buffer=le,R.connect(P.destination),R.start(0))},Q=()=>{if(R){try{R.stop()}catch{}R=null}},Ke=async()=>{if(I.value){I.value=!1,Q();return}if(!P&&typeof window<"u"&&(P=new(window.AudioContext||window.webkitAudioContext)),i.value.audioData&&!le&&P)try{const u=await(await fetch(i.value.audioData)).arrayBuffer();le=await P.decodeAudioData(u)}catch(a){console.error("Failed to decode preview audio",a)}const e=new ge({difficulty:i.value.difficulty});e.obstacles=[...i.value.engineObstacles],e.portals=[...i.value.enginePortals],e.totalLength=$.value;const t=await e.computeAutoplayLogAsync(200,360,()=>{});i.value.autoplayLog=e.autoplayLog,!(!t&&!confirm("AI cannot find a clear path! Preview anyway?"))&&(I.value=!0,te.value=0,O.value=[],g.value=0,ze())},Ze=async()=>{if(!X.value){X.value=!0,console.log("Starting map test simulation...");try{const e=new ge({difficulty:i.value.difficulty});e.obstacles=[...i.value.engineObstacles],e.portals=[...i.value.enginePortals],e.totalLength=$.value,console.log("Computing autoplay log..."),await new Promise(a=>setTimeout(a,50));const t=await e.computeAutoplayLogAsync(200,360,a=>{});if(i.value.autoplayLog=e.autoplayLog,console.log("Autoplay computation result:",t),!t&&!confirm("AI cannot finish this map! Play anyway?")){X.value=!1;return}sessionStorage.setItem("umm_edit_map",JSON.stringify(i.value)),sessionStorage.setItem("umm_is_test","true"),sessionStorage.setItem("umm_load_map",JSON.stringify(i.value)),he.push("/play")}catch(e){console.error("Test map error:",e),alert("An error occurred during test preparation: "+e.message),X.value=!1}}},qe=async()=>{if(!q.value){q.value=!0;try{const e=!i.value._id,t=e?"/api/maps":`/api/maps/${i.value._id}`,a=e?"POST":"PATCH";e&&(i.value.creatorName=me.value?.username||"Guest");const u=i.value.audioData;if(u&&u.length>Ee){const r=ut(u,Ee),v={...i.value,audioData:null,audioChunks:[]},l=(await $fetch(t,{method:a,body:v}))._id;e&&(i.value._id=l);for(let s=0;s<r.length;s++)await $fetch(`/api/maps/${l}/audio-chunk`,{method:"POST",body:{chunkIndex:s,chunkData:r[s],totalChunks:r.length}});alert(`Map saved! (Audio: ${r.length} chunks)`)}else{const r=await $fetch(t,{method:a,body:i.value});e&&(i.value._id=r._id),alert("Map saved successfully!")}}catch(e){console.error("Save error:",e);const t=e.response?._data||{};if(t.statusMessage==="MUSIC_NOT_IN_SERVER"){const a=t.data?.guide||"ìŒì•… íŒŒì¼ì„ ì„œë²„ì— ì €ìž¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",u=t.data?.contact||"ê´€ë¦¬ìžì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.";alert(`${a}

ë¬¸ì˜ì²˜: ${u}`)}else{const a=t.statusMessage||e.message||"Unknown error";alert(`Failed to save map: ${a}`)}}finally{q.value=!1}}};let ke;const Te=()=>{if(!x.value)return;const e=x.value.getContext("2d");if(!e)return;const t=x.value.width,a=x.value.height,u=performance.now()/1e3;e.clearRect(0,0,t,a),e.fillStyle="#050510",e.fillRect(0,0,t,a),e.save(),e.scale(h.value,h.value),e.translate(-g.value,0),e.strokeStyle="rgba(255, 255, 255, 0.05)";const r=50,v=Math.floor(g.value/r)*r;for(let l=v;l<g.value+t/h.value;l+=r)e.beginPath(),e.moveTo(l,0),e.lineTo(l,a/h.value),e.stroke();for(let l=0;l<a/h.value;l+=r)e.beginPath(),e.moveTo(g.value,l),e.lineTo(g.value+t/h.value,l),e.stroke();if(e.fillStyle="rgba(255, 0, 0, 0.1)",e.fillRect(g.value,0,t/h.value,140),e.fillRect(g.value,580,t/h.value,a/h.value-580),e.strokeStyle="#ff3333",e.lineWidth=3,e.beginPath(),e.moveTo(g.value,140),e.lineTo(g.value+t/h.value,140),e.stroke(),e.beginPath(),e.moveTo(g.value,580),e.lineTo(g.value+t/h.value,580),e.stroke(),e.fillStyle="#ff3333",e.font="bold 12px Outfit",e.fillText("CEILING BOUNDARY",g.value+10,130),e.fillText("FLOOR BOUNDARY",g.value+10,575),i.value.autoplayLog&&i.value.autoplayLog.length>1){e.save(),e.strokeStyle="rgba(255, 0, 255, 0.4)",e.lineWidth=4,e.setLineDash([10,5]),e.beginPath(),e.moveTo(i.value.autoplayLog[0].x,i.value.autoplayLog[0].y);for(let l=1;l<i.value.autoplayLog.length;l++)e.lineTo(i.value.autoplayLog[l].x,i.value.autoplayLog[l].y);e.stroke(),e.setLineDash([]),e.globalAlpha=1,e.restore()}i.value.enginePortals.forEach(l=>{const s=C.getPortalColor(l.type);e.save(),l.angle&&(e.translate(l.x+l.width/2,l.y+l.height/2),e.rotate(l.angle*Math.PI/180),e.translate(-(l.x+l.width/2),-(l.y+l.height/2))),e.fillStyle=s,e.shadowBlur=15,e.shadowColor=s,e.globalAlpha=.2,e.fillRect(l.x,l.y,l.width,l.height),e.globalAlpha=1,e.strokeStyle="#fff",e.lineWidth=2,e.strokeRect(l.x,l.y,l.width,l.height),e.fillStyle="#fff",e.font="bold 20px Outfit",e.textAlign="center",e.fillText(C.getPortalSymbol(l.type),l.x+l.width/2,l.y+l.height/2+8),e.restore(),o.value.includes(l)&&(e.strokeStyle="#00ffff",e.lineWidth=3,e.strokeRect(l.x-5,l.y-5,l.width+10,l.height+10)),K.value&&(e.strokeStyle="#00ff00",e.lineWidth=1,e.setLineDash([4,4]),e.strokeRect(l.x,l.y,l.width,l.height),e.setLineDash([]))}),i.value.engineObstacles.forEach(l=>{e.save(),l.movement&&l.movement.type==="updown"&&(e.strokeStyle="rgba(0, 255, 255, 0.1)",e.beginPath(),e.moveTo(l.x+l.width/2,(l.initialY||l.y)-l.movement.range),e.lineTo(l.x+l.width/2,(l.initialY||l.y)+l.movement.range),e.stroke());const s=C.getObstacleStateAt(l,u),m=l.x,y=s.y,k=s.angle;it(e,l,m,y,u,!0,k),K.value&&(e.strokeStyle="#00ff00",e.lineWidth=1,e.setLineDash([4,4]),e.strokeRect(m,y,l.width,l.height),e.setLineDash([])),e.restore()});const d=$.value;if(e.strokeStyle="#00ff88",e.lineWidth=8,e.setLineDash([15,10]),e.beginPath(),e.moveTo(d,0),e.lineTo(d,a/h.value),e.stroke(),e.setLineDash([]),e.fillStyle="#00ff88",e.font="900 32px Outfit",e.textAlign="center",e.fillText("FINISH LINE",d,100),e.textAlign="left",o.value.forEach(l=>{if(e.save(),e.strokeStyle="#00ffff",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(l.x,l.y,l.width,l.height),e.setLineDash([]),o.value.length===1){e.fillStyle="#fff";const s=6/h.value;e.fillRect(l.x-s,l.y-s,s*2,s*2),e.fillRect(l.x+l.width-s,l.y-s,s*2,s*2),e.fillRect(l.x-s,l.y+l.height-s,s*2,s*2),e.fillRect(l.x+l.width-s,l.y+l.height-s,s*2,s*2)}e.restore()}),W.value){e.fillStyle="rgba(0, 255, 255, 0.1)",e.strokeStyle="#00ffff",e.lineWidth=1;const l=Math.min(b.value.x1,b.value.x2),s=Math.min(b.value.y1,b.value.y2),m=Math.abs(b.value.x2-b.value.x1),y=Math.abs(b.value.y2-b.value.y1);e.fillRect(l,s,m,y),e.strokeRect(l,s,m,y)}if(I.value){if(O.value.length>1){e.save(),e.beginPath(),e.moveTo(O.value[0].x,O.value[0].y);for(let s=1;s<O.value.length;s++)e.lineTo(O.value[s].x,O.value[s].y);e.strokeStyle="rgba(0, 255, 255, 0.6)",e.lineWidth=14/h.value,e.lineCap="round",e.lineJoin="round",e.stroke(),e.restore()}const l=i.value.autoplayLog;if(l&&l.length>0){const s=performance.now()/1e3;G||(G=s);const m=s-G;G=s,te.value+=m;let y=l[0];for(let k=0;k<l.length;k++){if(l[k].time>=te.value){if(k>0){const V=l[k-1],fe=l[k],Se=(te.value-V.time)/(fe.time-V.time);y={x:V.x+(fe.x-V.x)*Se,y:V.y+(fe.y-V.y)*Se,holding:V.holding}}else y=l[k];break}y=l[l.length-1]}Z.value=y.x,ue.value=y.y,O.value.push({x:Z.value,y:ue.value}),O.value.length>500&&O.value.shift(),g.value=Math.max(0,Z.value-200),e.save(),e.fillStyle=y.holding?"#ff00ff":"#00ffff",e.shadowBlur=25,e.shadowColor=e.fillStyle,e.beginPath(),e.arc(Z.value,ue.value,18/h.value,0,Math.PI*2),e.fill(),e.restore(),Z.value>=$.value&&(I.value=!1,G=0,Q())}}else G=0;e.restore(),ke=requestAnimationFrame(Te)},j=e=>{o.value.forEach(t=>{"angle"in t&&(t.angle=(t.angle||0)+e,t.angle<0&&(t.angle+=360),t.angle>=360&&(t.angle-=360))}),B()};return tt(()=>{const e=sessionStorage.getItem("umm_edit_map");e&&(i.value=JSON.parse(e),sessionStorage.removeItem("umm_edit_map"),pe()),B(),typeof window<"u"&&!P&&(P=new(window.AudioContext||window.webkitAudioContext)),Te();const t=u=>{if(!(u.target instanceof HTMLInputElement||u.target instanceof HTMLTextAreaElement||u.target instanceof HTMLSelectElement))if(u.key==="Shift"&&(D.value=!0),u.ctrlKey||u.metaKey)if(u.key==="c")o.value.length>0&&(Y.value=o.value.map(r=>({...r,_id:void 0})));else if(u.key==="x")o.value.length>0&&(Y.value=o.value.map(r=>({...r,_id:void 0})),se());else if(u.key==="v"){if(Y.value.length>0){const r=Math.min(...Y.value.map(d=>d.x));Math.min(...Y.value.map(d=>d.y));const v=Y.value.map(d=>{const l={...d,x:g.value+(d.x-r)+100,y:d.y};return ie.includes(l.type)?i.value.engineObstacles.push(l):i.value.enginePortals.push(l),l});o.value=v,B()}}else u.key==="z"?Re():u.key==="y"&&Ne();else u.key==="Delete"||u.key==="Backspace"?o.value.length>0&&se():u.key.toLowerCase()==="r"&&o.value.length>0&&j(45)},a=u=>{u.key==="Shift"&&(D.value=!1)};window.addEventListener("keydown",t),window.addEventListener("keyup",a),lt(()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",a),cancelAnimationFrame(ke),Q(),Q(),window.removeEventListener("resize",re)}),re(),window.addEventListener("resize",re)}),(e,t)=>(f(),p("div",vt,[t[59]||(t[59]=n("div",{class:"background-anim"},null,-1)),n("header",dt,[n("div",ct,[t[29]||(t[29]=n("h1",{class:"title"},[ee("MAP_ARCHITECT "),n("span",{class:"version"},"v2.0")],-1)),n("div",pt,[S(n("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>i.value.title=a),placeholder:"Map Title",class:"map-title-input"},null,512),[[M,i.value.title]]),n("span",ft,"BY: "+w(Me(me)?.username||"Guest"),1)])]),n("div",gt,[n("div",ht,[T.value?(f(),p("button",{key:0,onClick:t[1]||(t[1]=a=>N.value=!N.value),class:L(["control-btn mobile-toggle",{active:N.value}])}," ðŸŽ¨ ",2)):E("",!0),n("button",{onClick:Ze,class:"control-btn test",disabled:X.value},[t[30]||(t[30]=n("span",{class:"icon"},"â–¶",-1)),t[31]||(t[31]=ee()),T.value?E("",!0):(f(),p("span",yt,w(X.value?"TESTING...":"TEST"),1))],8,mt),n("button",{onClick:Ke,class:L(["control-btn tutorial",{active:I.value}])},[t[32]||(t[32]=n("span",{class:"icon"},"ðŸŽ“",-1)),t[33]||(t[33]=ee()),T.value?E("",!0):(f(),p("span",wt,w(I.value?"STOP":"TUTORIAL"),1))],2),n("button",{onClick:qe,class:"control-btn save",disabled:q.value},[t[34]||(t[34]=n("span",{class:"icon"},"ðŸ’¾",-1)),t[35]||(t[35]=ee()),T.value?E("",!0):(f(),p("span",xt,w(q.value?"SAVING...":"SAVE"),1))],8,bt),n("button",{onClick:t[2]||(t[2]=a=>K.value=!K.value),class:L(["control-btn",{active:K.value}])},[t[36]||(t[36]=n("span",{class:"icon"},"â›¶",-1)),t[37]||(t[37]=ee()),T.value?E("",!0):(f(),p("span",kt,"HITBOX"))],2),T.value?(f(),p("button",{key:1,onClick:t[3]||(t[3]=a=>U.value=!U.value),class:L(["control-btn mobile-toggle",{active:U.value}])}," âš™ï¸ ",2)):E("",!0),n("button",{onClick:t[4]||(t[4]=a=>Me(he).push("/maps")),class:"control-btn exit"},[T.value?(f(),p("span",St,"âœ•")):(f(),p("span",Tt,"EXIT"))])])]),n("div",Mt,[n("div",Et,[n("span",Ot,"OBJ: "+w(i.value.engineObstacles.length),1),n("span",_t,"PORT: "+w(i.value.enginePortals.length),1)])])]),n("div",{class:L(["main-layout",{"is-mobile":T.value}])},[n("aside",{class:L(["sidebar left-sidebar glass-panel",{"mobile-drawer":T.value,open:N.value}])},[T.value?(f(),p("div",At,[t[38]||(t[38]=n("h3",null,"PALETTE",-1)),n("button",{onClick:t[5]||(t[5]=a=>N.value=!1),class:"close-drawer"},"âœ•")])):(f(),p("h3",Pt,"PALETTE")),n("div",Lt,[(f(),p(J,null,oe(ie,a=>n("div",{key:a,class:L(["palette-item",{selected:z.value===a}]),onClick:u=>z.value=a},[n("div",Dt,w(Ae(a)),1),n("span",It,w(a.split("_").join(" ").toUpperCase()),1)],10,Ct)),64)),t[39]||(t[39]=n("div",{class:"separator"},"PORTALS",-1)),(f(),p(J,null,oe(_e,a=>n("div",{key:a,class:L(["palette-item portal",{selected:z.value===a}]),onClick:u=>z.value=a},[n("div",Nt,w(Pe(a)),1),n("span",Ut,w(a.split("_").join(" ").toUpperCase()),1)],10,Rt)),64))])],2),n("main",{class:"workspace glass-panel",ref_key:"workspaceRef",ref:Oe,onMousedown:Be,onMousemove:Ve,onMouseup:$e,onWheel:Ye,onContextmenu:t[7]||(t[7]=at(()=>{},["prevent"]))},[n("canvas",{ref_key:"canvasRef",ref:x,width:"1200",height:"600",class:"editor-canvas"},null,512),n("div",Bt,[n("span",null,"ZOOM: "+w((h.value*100).toFixed(0))+"%",1),n("span",null,"X: "+w(Math.floor(g.value)),1)]),n("div",Vt,[S(n("input",{type:"range",min:"0",max:$.value,"onUpdate:modelValue":t[6]||(t[6]=a=>g.value=a),class:"timeline-slider"},null,8,$t),[[M,g.value,void 0,{number:!0}]])])],544),n("aside",{class:L(["sidebar right-sidebar glass-panel",{"mobile-drawer":T.value,open:U.value}])},[T.value?(f(),p("div",Yt,[t[40]||(t[40]=n("h3",null,"PROPERTIES",-1)),n("button",{onClick:t[8]||(t[8]=a=>U.value=!1),class:"close-drawer"},"âœ•")])):(f(),p("h3",Gt,"PROPERTIES")),o.value.length===1?(f(),p("div",Wt,[n("div",Xt,[t[41]||(t[41]=n("label",null,"TYPE",-1)),n("span",Ft,w(o.value[0].type.toUpperCase()),1)]),n("div",Ht,[t[42]||(t[42]=n("label",null,"POSITION X / Y",-1)),n("div",Jt,[S(n("input",{type:"number","onUpdate:modelValue":t[9]||(t[9]=a=>o.value[0].x=a)},null,512),[[M,o.value[0].x,void 0,{number:!0}]]),S(n("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=a=>o.value[0].y=a)},null,512),[[M,o.value[0].y,void 0,{number:!0}]])])]),n("div",zt,[t[43]||(t[43]=n("label",null,"SIZE W / H",-1)),n("div",Kt,[S(n("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=a=>o.value[0].width=a)},null,512),[[M,o.value[0].width,void 0,{number:!0}]]),S(n("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=a=>o.value[0].height=a)},null,512),[[M,o.value[0].height,void 0,{number:!0}]])])]),n("div",Zt,[t[44]||(t[44]=n("label",null,"ROTATION (DEG)",-1)),n("div",qt,[n("button",{onClick:t[13]||(t[13]=a=>j(-45)),title:"Rotate -45",class:"rot-btn"},"â†º"),n("button",{onClick:t[14]||(t[14]=a=>j(45)),title:"Rotate 45",class:"rot-btn"},"â†»"),n("button",{onClick:t[15]||(t[15]=a=>j(90)),title:"Rotate 90",class:"rot-btn"},"90Â°"),n("button",{onClick:t[16]||(t[16]=a=>j(180)),title:"Rotate 180",class:"rot-btn"},"180Â°")]),n("div",Qt,[S(n("input",{type:"number","onUpdate:modelValue":t[17]||(t[17]=a=>o.value[0].angle=a)},null,512),[[M,o.value[0].angle,void 0,{number:!0}]]),S(n("input",{type:"range",min:"0",max:"360","onUpdate:modelValue":t[18]||(t[18]=a=>o.value[0].angle=a)},null,512),[[M,o.value[0].angle,void 0,{number:!0}]])])]),o.value[0].movement?(f(),p("div",jt,[t[48]||(t[48]=n("label",null,"MOVEMENT TYPE",-1)),n("select",{value:o.value[0].movement.type,onChange:t[19]||(t[19]=a=>Xe(a.target.value))},[...t[45]||(t[45]=[nt('<option value="none" data-v-659ca0d8>NONE</option><option value="updown" data-v-659ca0d8>UP-DOWN</option><option value="leftright" data-v-659ca0d8>LEFT-RIGHT</option><option value="rotate" data-v-659ca0d8>ROTATE</option><option value="bounce" data-v-659ca0d8>BOUNCE</option>',5)])],40,el),o.value[0].movement.type!=="none"?(f(),p(J,{key:0},[t[46]||(t[46]=n("label",null,"SPEED / RANGE",-1)),n("div",tl,[S(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[20]||(t[20]=a=>o.value[0].movement.speed=a),placeholder:"Speed"},null,512),[[M,o.value[0].movement.speed,void 0,{number:!0}]]),S(n("input",{type:"number","onUpdate:modelValue":t[21]||(t[21]=a=>o.value[0].movement.range=a),placeholder:"Range"},null,512),[[M,o.value[0].movement.range,void 0,{number:!0}]])]),t[47]||(t[47]=n("label",null,"PHASE OFFSET",-1)),S(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[22]||(t[22]=a=>o.value[0].movement.phase=a)},null,512),[[M,o.value[0].movement.phase,void 0,{number:!0}]])],64)):E("",!0)])):E("",!0),["planet","star"].includes(o.value[0].type)?(f(),p(J,{key:1},[o.value[0].type==="planet"?(f(),p("div",ll,[t[49]||(t[49]=n("label",null,"ORBIT MOON COUNT",-1)),S(n("input",{type:"number","onUpdate:modelValue":t[23]||(t[23]=a=>H(o.value[0]).orbitCount=a),placeholder:"0 or 2"},null,512),[[M,H(o.value[0]).orbitCount,void 0,{number:!0}]])])):E("",!0),t[50]||(t[50]=n("label",null,"ORBIT SPEED",-1)),S(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[24]||(t[24]=a=>H(o.value[0]).orbitSpeed=a),placeholder:"Speed"},null,512),[[M,H(o.value[0]).orbitSpeed,void 0,{number:!0}]]),t[51]||(t[51]=n("label",null,"ORBIT DISTANCE",-1)),S(n("input",{type:"number","onUpdate:modelValue":t[25]||(t[25]=a=>H(o.value[0]).orbitDistance=a),placeholder:"Distance"},null,512),[[M,H(o.value[0]).orbitDistance,void 0,{number:!0}]]),o.value[0].type==="star"?(f(),p("div",al," Drag a Planet onto this Star to attach it! ")):E("",!0),o.value[0].children&&o.value[0].children.length>0?(f(),p("div",nl,[n("label",null,"ATTACHED PLANETS: "+w(o.value[0].children.length),1),(f(!0),p(J,null,oe(o.value[0].children,(a,u)=>(f(),p("div",{key:u,class:"child-item"},[n("span",null,"Planet "+w(u+1),1)]))),128))])):E("",!0)],64)):E("",!0),n("button",{onClick:se,class:"delete-btn"},"DELETE OBJECT")])):o.value.length>1?(f(),p("div",sl,[n("div",ol,[t[52]||(t[52]=n("label",null,"MULTIPLE SELECTION",-1)),n("span",il,w(o.value.length)+" OBJECTS",1)]),n("button",{onClick:se,class:"delete-btn"},"DELETE ALL")])):(f(),p("div",ul," SELECT OBJECTS TO MODIFY ")),t[57]||(t[57]=n("div",{class:"global-settings prop-group"},[n("h3",null,"LEVEL CONFIG")],-1)),n("div",rl,[t[54]||(t[54]=n("h3",null,"AUDIO CONFIG",-1)),t[55]||(t[55]=n("label",null,"BPM",-1)),S(n("input",{type:"number","onUpdate:modelValue":t[26]||(t[26]=a=>i.value.bpm=a)},null,512),[[M,i.value.bpm,void 0,{number:!0}]]),t[56]||(t[56]=n("label",null,"MEASURE LENGTH (S)",-1)),S(n("input",{type:"number",step:"0.1","onUpdate:modelValue":t[27]||(t[27]=a=>i.value.measureLength=a)},null,512),[[M,i.value.measureLength,void 0,{number:!0}]]),n("div",vl,[t[53]||(t[53]=n("label",null,"AUDIO FILE",-1)),n("button",{onClick:He,class:"upload-btn"},w(i.value.audioData?"AUDIO LOADED":"UPLOAD MP3"),1),n("input",{type:"file",ref_key:"audioInputRef",ref:ye,accept:"audio/*",style:{display:"none"},onChange:Je},null,544),i.value.audioData?(f(),p("p",dl,"Audio embedded in map data")):E("",!0)])])],2)],2),we.value?(f(),p("div",cl,[n("div",pl,[t[58]||(t[58]=n("h2",null,"SMART MAP GENERATION",-1)),n("div",fl,[n("div",gl,[n("div",{class:"fill",style:st({width:ve.value+"%"})},null,4)]),n("span",hl,w(Ie(Ce.value))+" ("+w(ve.value.toFixed(0))+"%)",1)]),n("div",ml,[(f(!0),p(J,null,oe(Le.value,(a,u)=>(f(),p("div",{key:u,class:"log-line"},w(a),1))),128))]),n("div",yl,[n("button",{onClick:t[28]||(t[28]=a=>we.value=!1),disabled:De.value&&ve.value<100,class:"control-btn exit"},"CLOSE",8,wl)])])])):E("",!0)]))}}),El=rt(bl,[["__scopeId","data-v-659ca0d8"]]);export{El as default};
